---
title: "FigureYa238corRiskMut"
author: "Xiaofan Lu"
reviewers: "Ying Ge,Hui Huang"
date: "2025-5-20"
output: html_document
---
# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述

小丫老师，想众筹下FigA-C，预后模型建立后寻找高低风险组中突变最显著的基因，并计算riskscore与有义和错义突变的相关性，谢谢啦

# Requirement Description

Teacher Xiaoya, I want to crowdfund FigA-C, find the most significant mutations in the high and low risk groups after the prognostic model is established, and calculate the correlation between riskscore and sense and missense mutations, thank you

![](example.png)

出自<https://www.nature.com/articles/s41388-021-01853-y>
from<https://www.nature.com/articles/s41388-021-01853-y>

Fig. 5 TMErisk was related to tumor mutation status.
A Association between synonymous mutation counts, non-synonymous mutation counts, all mutation counts, and TMErisk score and their distribution in the low- and the high-TMErisk groups.
B Forest plot of genes mutating differentially in patients of the low- and the high-TMErisk groups.
C Interaction effect of genes mutating differentially in patients in the low- and the high-TMErisk groups.

**Mutation status in LUAD patients in the high- and the low-TMErisk groups**

To investigate **TMErisk-related mechanisms** in LUAD, somatic mutations from the TCGA database were also analyzed. When comparing the mutant frequency between samples of the low- and the high-TMErisk groups, **more somatic mutations were observed in the high-TMErisk group**, including non-synonymous and synonymous mutations (Fig. 5A). Meanwhile, maftools analysis results showed that 19 genes mutated more frequently in LUAD patients in the high- TMErisk group, including TP53, ASTN1, RYR2, XIRP2, LRP1B, CSMD1, RYR3, PCDH15, TTN, KEAP1, ADAMTS12, ERICH3, DMD, CDH10, SI, SYNE1, NRXN1, CACNA1E, and COL11A1 (Fig. 5B). Among these genes, eight were expressed differentially between the wild type and the mutant type (Fig. S8). The frequency of mutations in these genes was also shown in Fig. 4. Moreover, significant co-occurrences were observed among mutations of these genes (Fig. 5C).

# 应用场景

看到免疫浸润跟预后风险的关系，想进一步探究机制，例文作者从突变数据入手。

文章里有多个图可以用我们的FigureYa实现：

- Figure 2B 森林图，可参考FigureYa47HRtable和FigureYa193RiskTable；
- Figure 2C Time-dependent AUC，可参考FigureYa85timeROC；
- Figure 4 Landscape of immune and stromal cell infiltrations，可参考FigureYa230immunelandscape
- Figure 5D 对比的饼图，可参考FigureYa196PanPie

# Application Scenarios

Seeing the relationship between immune infiltration and prognostic risk, and wanting to further explore the mechanism, the author of the example article started with mutation data.

There are several diagrams in the article that can be implemented with our FigureYa:

- Figure 2B Forest Chart, see FigureYa47HRtable and FigureYa193RiskTable;
- Figure 2C Time-dependent AUC, see FigureYa85timeROC;
- Figure 4 Landscape of immune and stromal cell infiltrations, see FigureYa230immunelandscape
- For a pie chart compared to Figure 5D, see FigureYa196PanPie

# 环境设置


# Environment settings


```{r eval=TRUE}
source("install_dependencies.R")

BiocManager::install("maftools")
install.packages("ggplot2")
```

加载包
load packages

```{r}
library(data.table)
library(maftools)
library(tidyverse)
library(magrittr)
library(readxl)
library(stringr)
library(forcats)
library(ggplot2)
library(ggpubr)
library(cowplot)
library(patchwork)

Sys.setenv(LANGUAGE = "en") #显示英文报错信息 # error messages are displayed in English
options(stringsAsFactors = FALSE) #禁止chr转成factor # chr is not allowed to be converted to factor
```

# 输入文件

以下两个文件较大，已上传至微云<https://share.weiyun.com/ks0OVM7a>。建议按以下方式直接从官网下载：

- 表达数据：TCGA-LUAD.htseq_fpkm.tsv.gz，gene expression RNAseq - HTSeq - FPKM，下载自 [XENA](https://xenabrowser.net/datapages/) [GDC TCGA Lung Adenocarcinoma (LUAD) (15 datasets)](https://xenabrowser.net/datapages/?dataset=TCGA-LUAD.htseq_fpkm.tsv&host=https%3A%2F%2Fgdc.xenahubs.net&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443)，

- 突变数据：data_mutations_extended.txt，下载自[cBioPortal](http://www.cbioportal.org/datasets)，下载luad_tcga_pan_can_atlas_2018.tar.gz文件，解压缩把其中的data_mutations_extended.txt文件移到当前文件夹。

# Input files

The following two files are large and have been uploaded to the Weiyun <https://share.weiyun.com/ks0OVM7a>. It is recommended to download it directly from the official website in the following ways:

- Expression data :TCGA-LUAD.htseq_fpkm.tsv.gz, gene expression RNAseq - HTSeq - FPKM, downloaded from [XENA](https://xenabrowser.net/datapages/) [GDC TCGA Lung Adenocarcinoma (LUAD) (15 datasets)](https://xenabrowser.net/datapages/?dataset=TCGA-LUAD.htseq_fpkm.tsv&host=https://gdc.xenahubs.net&removeHub=https://xena.treehouse.gi.ucsc.edu:443)，

- :data_mutations_extended.txt mutation data, download it from [cBioPortal](http://www.cbioportal.org/datasets), download the luad_tcga_pan_can_atlas_2018.tar.gz file, unzip it, and put the data_mutations_ extended.txt move the file to the current folder.

![](cbioportal.png)
