---
title: "FigureYa218Elasticnet"
author: "Xiaofan Lu; Ying Ge, Yijing Chen"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述
# Requirement description

我想众筹弹性网络筛选和分类的数据分析。根据表达矩阵，绘制figure2的A,B,C筛选和系数图，再根据结果绘制分类效果E图，得到准确率。

I would like to crowdfund data analysis for resilient network screening and classification. Based on the expression matrix, I will generate the screening and coefficient plots for groups A, B, and C as shown in Figure 2. Subsequently, I will plot the classification performance diagram E based on the results to determine the accuracy rate.

![](example.png)

出自<https://www.frontiersin.org/articles/10.3389/fgene.2020.00857/full>

FIGURE 2 | The screening and validation of 15 genes conducted by the diagnostic classifier.
(A,B) Binomial deviance as a function of the regularization parameter lambda for leave-one-study-out cross-validation on the training datasets. Points correspond to the means, and error bars correspond to the standard deviations. Coefficients of 15 genes were selected by the lambda with the minimum binomial deviance marked by the blue dashed line (lambda = 0.025, ln(lambda) = −3.692).
(C) Coefficient values for each of the fifteen selected genes. A positive coefficient for a gene signature within its class indicates that elevated expression of this gene increases the probability of a specimen belonging to its tissue type.
(D) Heatmap for describing the expression levels of selected genes in the binomial classifier erected by training datasets. Each row is a gene with its Entrez Gene ID in parentheses; each column is a sample.
(E) Estimated probabilities for samples in testing datasets (GSE101685 and ICGC). For each sample, there are two points, corresponding to the probability that the sample belongs to the respective class. Within each dataset and class, samples are sorted by the probability of the true class. For most samples, the probability of the true subtype is near 1, indicating an unambiguous classification.

from<https://www.frontiersin.org/articles/10.3389/fgene.2020.00857/full>

FIGURE 2 | The screening and validation of 15 genes conducted by the diagnostic classifier.
(A,B) Binomial deviance as a function of the regularization parameter lambda for leave-one-study-out cross-validation on the training datasets. Points correspond to the means, and error bars correspond to the standard deviations. Coefficients of 15 genes were selected by the lambda with the minimum binomial deviance marked by the blue dashed line (lambda = 0.025, ln(lambda) = −3.692).
(C) Coefficient values for each of the fifteen selected genes. A positive coefficient for a gene signature within its class indicates that elevated expression of this gene increases the probability of a specimen belonging to its tissue type.
(D) Heatmap for describing the expression levels of selected genes in the binomial classifier erected by training datasets. Each row is a gene with its Entrez Gene ID in parentheses; each column is a sample.
(E) Estimated probabilities for samples in testing datasets (GSE101685 and ICGC). For each sample, there are two points, corresponding to the probability that the sample belongs to the respective class. Within each dataset and class, samples are sorted by the probability of the true class. For most samples, the probability of the true subtype is near 1, indicating an unambiguous classification.

# 应用场景
# Application scenario

根据弹性网络筛选变量构建分类模型，生成筛选和系数图，以及分类效果图。

更多机器学习相关FigureYa看这里<https://k.koudai.com/ZkmRxldV>

Construct a classification model by selecting variables based on the elastic net, generate screening and coefficient diagrams, as well as classification effect diagrams.

For more machine learning-related FigureYa, please refer to this link <https://k.koudai.com/ZkmRxldV>

# 环境设置
# Environment setting


```{r}
source("install_dependencies.R")

```

加载包

load package

```{r}
library(data.table)
library(glmnet)
library(limma)
library(ggplot2)
Sys.setenv(LANGUAGE = "en") #显示英文报错信息 display English error messages
options(stringsAsFactors = FALSE) #禁止chr转成factor prohibit the conversion of chr to factor
```

# 输入文件的获得
# Acquisition of input files

请到微云下载大文件<https://share.weiyun.com/HHLSNqoC>

提取感兴趣的肿瘤及对照组织的表达数据。如果你已经准备好，就跳过这步，直接进入“输入文件”。

这里用TCGA的肿瘤，用GTEX的正常组织作为对照。从UCSC xena<https://xenabrowser.net/datapages/>下载经过TOIL流程统一处理的TCGA和GTEx的TPM值，free of computational batch effects。从中提取肝癌和肝脏数据。

- TCGA与GTEX合并的表达数据：<https://xenabrowser.net/datapages/?dataset=TcgaTargetGtex_rsem_gene_tpm&host=https%3A%2F%2Ftoil.xenahubs.net&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443>
- 样本注释信息：<https://xenabrowser.net/datapages/?dataset=TcgaTargetGTEX_phenotype.txt&host=https%3A%2F%2Ftoil.xenahubs.net&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443>

我们在FigureYa55panCancer_violin有过类似的操作<https://www.yuque.com/figureya/figureyaplus/figureya55p>。更多pancancer相关FigureYa看这里<https://k.koudai.com/C8RkTgR3>

Please download large files from Weiyun<https://share.weiyun.com/HHLSNqoC>

Extract expression data for tumours and control tissues of interest. If you have already prepared these, skip this step and proceed directly to "Input Files".

Here, we utilise TCGA tumours with GTEX normal tissues as controls. Download the TPM values for TCGA and GTEx, processed uniformly via the TOIL workflow and free of computational batch effects, from UCSC xena<https://xenabrowser.net/datapages/>. Extract data for hepatocellular carcinoma and liver tissue.

- Combined TCGA and GTEX expression data: <https://xenabrowser.net/datapages/?dataset=TcgaTargetGtex_rsem_gene_tpm&host=https%3A%2F%2Ftoil.xenahubs.net&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443>
- Sample annotation information: <https://xenabrowser.net/datapages/?dataset=TcgaTargetGTEX_phenotype.txt&host=https%3A%2F%2Ftoil.xenahubs.net&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443>

我们在FigureYa55panCancer_violin有过类似的操作<https://www.yuque.com/figureya/figureyaplus/figureya55p>。更多pancancer相关FigureYa看这里<https://k.koudai.com/C8RkTgR3>

We have performed similar operations on FigureYa55panCancer_violin<https://www.yuque.com/figureya/figureyaplus/figureya55p>. For further pancancer related FigureYa, see here<https://k.koudai.com/C8RkTgR3>
