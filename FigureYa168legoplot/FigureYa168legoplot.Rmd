---
title: "FigureYa168legoplot"
author: "Bin Wei"
reviewer: "Ying Ge, Junyi Shen"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述
# Requirement

从基因组中获取突变位点context序列，用乐高图展示突变模式。
顺便画个pie。
Extract the context sequence of the mutation site from the genome and use a Lego plot to display the mutation pattern.
Draw a pie chart as well.

![](example.png)

出自<https://onlinelibrary.wiley.com/doi/full/10.1111/cas.14113>
From <https://onlinelibrary.wiley.com/doi/full/10.1111/cas.14113>

Figure 2 Mutational signatures extracted from the aggregated NSCLC dataset. A, Lego plot representation of mutation patterns in 113 NSCLC samples. Single-nucleotide substitutions are divided into 6 categories with 16 surrounding flanking bases. The pie chart in the upper left shows the proportion of 6 categories of mutation patterns.

**图的解读**
**Interpretation**

每种颜色内部是4X4结构，刚好对应TCGA四种碱基。因此，比通常所用的柱形图（例文Figure 2 B）更适合展示四种碱基的关系。
Each color contains a 4x4 structure, corresponding to the four TCGA bases. Therefore, this chart is more suitable for displaying the relationships between the four bases than the commonly used bar chart (see Figure 2 B).

至于6种颜色，你也可以画成1X6结构，作者画成2X3结构会更节省空间。
As for the six colors, you could also plot them in a 1x6 structure, but the author's 2x3 structure saves space.

柱子的高度代表第3种特征（这里是计数），除了柱子的形式以外，你也可以尝试换成圆点，用圆点大小来代替柱子的高度。或者把柱子换成热图，用颜色深浅代替柱子的高度。
The height of the bar represents the third feature (here, the count). Besides using the bar format, you could also try using dots, with the size of the dots representing the bar height. Alternatively, you could use a heat map, with the depth of the color representing the bar height.

# 应用场景
# Application Scenarios

同时展示3种特征。尤其适合其中一种特征具有m X n的特性的情况，例如文中的4种碱基 X 4种碱基。
Simultaneously displaying three features is particularly suitable when one of the features has an m x n structure, such as the 4 bases x 4 bases in the article.

# 环境设置
# Environment settings

```{r}
source("install_dependencies.R")
if (!requireNamespace("BiocManager", quietly = TRUE))
  install.packages("BiocManager")
if (!("BSgenome.Hsapiens.UCSC.hg19" %in% rownames(installed.packages()))) {
  BiocManager::install("BSgenome.Hsapiens.UCSC.hg19")
}
if (!("VariantAnnotation" %in% rownames(installed.packages()))) {
  BiocManager::install("VariantAnnotation")
}
if (!("rgl" %in% rownames(installed.packages()))) {
  install.packages("rgl")
}

Sys.setenv(LANGUAGE = "en") #显示英文报错信息 #Display English error message
options(stringsAsFactors = FALSE) #禁止chr转成factor # Disable conversion of chr to factor
```
加载自定义函数
Load custom functions

```{r}
source("functions.R")
```

# 输入文件
# Input file

easy_input.txt，突变数据，来自文章附件cas14113-sup-0002-tables1.xlsx。
easy_input.txt, mutation data, from the article attachment cas14113-sup-0002-tables1.xlsx.

不仅限于突变数据，如果你的数据已经整理成very_easy_input.csv格式，就跳过这步，直接进入“开始画图”。
This is not limited to mutation data. If your data is already organized in the very_easy_input.csv format, skip this step and proceed directly to "Start Plotting."

```{r}
data <- read.delim("easy_input.txt",
                   header=T,
                   sep="\t",
                   as.is=T)
head(data)
```

# 参数设置
# Parameter settings
