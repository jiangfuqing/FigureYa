---
title: "FigureYa97correlationV3"
author: "Shipeng Guo, Taojun Ye"
reviewer: "Ying Ge"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# 设置knitr的全局代码块选项 / Set global chunk options for knitr
```

## 需求描述

计算多个基因和免疫浸润的相关性，画出类似于文章中这种热图，用颜色展示相关系数，用**标出显著的。

## Requirement description

Calculate the correlation between multiple genes and immune infiltration, draw a heatmap similar to the one in the article, display the correlation coefficients with colors, and mark the significant ones with * *.

![](example.png)

出自<https://www.nature.com/articles/s41586-019-1032-7>

from<https://www.nature.com/articles/s41586-019-1032-7>

## 应用场景

评价基因对免疫浸润的影响，甚至可以批量筛选出影响免疫浸润的候选基因。

其本质是计算两种特征之间的相关性，此处的免疫浸润可以换成其他变量，例如临床表型等等。

如果要同时展示两个基因之间的相关性，及其与免疫浸润之间的关系，请参考“FigureYa96R2”。

## Application scenarios

Evaluate the impact of genes on immune infiltration, and even screen candidate genes that affect immune infiltration in batches.

Its essence is to calculate the correlation between two features, where immune infiltration can be replaced with other variables such as clinical phenotype, etc.

If you want to simultaneously demonstrate the correlation between two genes and their relationship with immune infiltration, please refer to "FigureYa96R2".

## 环境设置

加载包

## Environment settings

Load Package

```{r}
source("install_dependencies.R")
# 加载ggplot2包，用于数据可视化
# Load the ggplot2 package for data visualization
library(ggplot2)

# 加载dplyr包，用于数据处理和转换
# Load the dplyr package for data manipulation and transformation
library(dplyr)

# 设置环境变量，使R显示英文错误信息（便于搜索解决方案）
# Set environment variable to display error messages in English (easier for searching solutions)
Sys.setenv(LANGUAGE = "en")

# 全局选项设置：禁止将字符型变量自动转换为因子类型
# Global option setting: prevent automatic conversion of character variables to factors
options(stringsAsFactors = FALSE)
```

## 输入文件

要求前两个文件的样本名一致

- ssGSEA_output.csv，免疫细胞矩阵，列是免疫细胞，行是样本，由FigureYa71ssGSEA产生。如果对免疫浸润不感兴趣，就把ssGSEA_output.csv换成其他类型的数据，例如临床指标什么的，只要保证样品名跟easy_input_expr.csv一致就好了。
- easy_input_expr.csv，基因表达矩阵，列是样本，行是基因。行也可以是转录本，甚至是临床信息。
- genelist.txt，基因名，将要计算这些基因跟免疫浸润的相关性。要求跟easy_input_expr.csv里的基因名一致。

## Input file

Require the sample names of the first two files to be consistent

- ssGSEA_output.csv， Immune cell matrix, with columns representing immune cells and rows representing samples, generated by FigureYa71ssGSEA. If you are not interested in immune infiltration, you can replace ssGSEA_output. csv with other types of data, such as clinical indicators, as long as the sample name is consistent with easyinput.exe. csv.
- easy_input_expr.csv， Gene expression matrix, with columns representing samples and rows representing genes. It can also be a transcript or even clinical information.
- genelist.txt， The gene names will be used to calculate the correlation between these genes and immune infiltration. Require the gene name to be consistent with the one in easy_input-expr.csv.
