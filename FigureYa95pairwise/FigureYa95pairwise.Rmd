---
title: "FigureYa95pairwise"
author: "Xiaofan Lu, Taojun Ye"
reviewer: "Ying Ge"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# 设置knitr的全局代码块选项 / Set global chunk options for knitr
```

## 需求描述

用TCGA的表达谱和体细胞突变作为输入，把体细胞突变MAF文件转为二元突变矩阵，用表达谱计算免疫细胞浸润得分；计算样本相似性并绘制相关性散点图。

（实质：对距离矩阵或相似性矩阵作相关性分析）

## Requirement Description

Use TCGA expression profiles and somatic mutations as inputs, convert somatic mutation MAF files to binary mutation matrices, use expression profiles to calculate immune cell infiltration scores; calculate sample similarity and plot correlation scatter plots.

(Substance: correlation analysis of distance matrix or similarity matrix)

![](example.png)

出自<https://www.nature.com/articles/s41586-019-1032-7>

from<https://www.nature.com/articles/s41586-019-1032-7>

## 应用场景

多维度相关性研究，例如：推断体细胞突变和免疫浸润在影响肿瘤异质性上的相关程度。

## Application Scenarios

Multidimensional correlation studies, e.g., to infer the extent to which somatic mutations and immune infiltration are relevant in influencing tumor heterogeneity.

## 环境设置


## Environment settings


```r

if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("GSVA")
install.packages("ClassDiscovery")
```

加载包

library packages

```{r}
source("install_dependencies.R")
# 加载GSVA包，用于基因集变异分析 (Load the GSVA package for gene set variation analysis)
library(GSVA)
# 加载ClassDiscovery包，用于外部聚类分析 (Load the ClassDiscovery package for external clustering analysis)
library(ClassDiscovery)
# 加载vegan包，用于生态与二元变量的距离计算 (Load the vegan package for ecological and binary variable distance calculations)
library(vegan)

# 设置环境语言为英文，以便显示英文报错信息 (Set environment language to English for English error messages)
Sys.setenv(LANGUAGE = "en")
# 禁止字符串自动转换为因子类型，避免数据处理中的意外转换 (Disable automatic conversion of strings to factors)
options(stringsAsFactors = FALSE)
```

## 输入数据预处理

需要三种文件：

- easy_input_expr1.csv，easy_input_expr2.csv，TCGA的表达数据。数据下载可参考“小丫画图”微店“TCGA”分类中以前的代码，例如FigureYa34count2FPKMv2。
- easy_input_maf1.txt，easy_input_maf2.txt，TCGA的突变数据。数据下载可参考“小丫画图”微店“TCGA”分类中以前的代码，例如FigureYa18oncoplot。
- immunitygene.csv，免疫细胞marker基因，这里用GSVA。还可以用MCPcounter，可参考FigureYa56immune_inflitration，或FigureYa71ssGSEA。

## Input data preprocessing

Three files are needed:

- easy_input_expr1.csv, easy_input_expr2.csv, TCGA expression data. For data download, please refer to the previous code in the “TCGA” category of “Xiaoya Drawing” microstore, for example, FigureYa34count2FPKMv2.
- easy_input_maf1.txt, easy_input_maf2.txt, TCGA mutation data. For data download, please refer to the previous codes in the “TCGA” category of “Xiaoya's Drawing” microstore, e.g. FigureYa18oncoplot.
- immunitygene.csv, immunity cell marker gene, here we use GSVA, we can also use MCPcounter, please refer to FigureYa56immune_inflitration, or FigureYa71ssGSEA.
