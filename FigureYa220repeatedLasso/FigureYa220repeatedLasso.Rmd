---
title: "FigureYa220repeatedLasso"
author: "Xiaofan Lu"
reviewers: "Ying Ge,Hui Huang"
date: "2025-5-20"
output: html_document
---
# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述

FigureYa182RFSurv和FigureYa198SignatureComb都是根据基因的重要性筛选的。直接根据随机森林的准确度或cox模型的frequency筛选，又是另一种不同的展示方式。

# Requirement Description

Both FigureYa182RFSurv and FigureYa198SignatureComb were screened based on the importance of genes. Filtering directly based on the accuracy of the random forest or the frequency of the COX model is another different way to display it.

![](example.png)

出自<https://translational-medicine.biomedcentral.com/articles/10.1186/s12967-019-1824-4>
from<https://translational-medicine.biomedcentral.com/articles/10.1186/s12967-019-1824-4>

Fig. 2 a Generation of the ten gene groups after 1000 iteration. The gene model with 30 immune related genes was selected to construct the signature as its highest frequencies of 211 compared to other nine gene models. b The c‐index of both training and testing sets. The c‐index for TCGA dataset, GSE30219, GSE31210, GSE3141, and GSE81089 were 0.723, 0.657, 0.7061, 0.641, and 0.619 respectively

# 应用场景

这里用的cox模型的10折交叉验证

# Application Scenarios

Here is a 10-fold cross-validation of the COX model

Using Cox proportional hazards model (iteration = 1000) with an lasso penalty to find the best gene model.

# 环境设置


# Environment settings


```{r}
source("install_dependencies.R")
```

```{r eval=FALSE}

BiocManager::install("survcomp")
```

加载包
load packages

```{r}
library(survival)
library(glmnet)
library(pbapply)
library(survcomp)
Sys.setenv(LANGUAGE = "en") #显示英文报错信息 # error messages are displayed in English
options(stringsAsFactors = FALSE) #禁止chr转成factor # chr is not allowed to be converted to factor
```

自定义函数
Custom functions
```{r}
display.progress = function (index, totalN, breakN=20) {

  if ( index %% ceiling(totalN/breakN)  ==0  ) {
    cat(paste(round(index*100/totalN), "% ", sep=""))
  }
}
```

# 输入文件

表达谱文件较大，已上传至微云<https://share.weiyun.com/0esnGlCh>

- InnateDB_genes.csv，免疫基因集。数据来自<https://www.innatedb.com/redirect.do?go=resourcesGeneLists> Immunogenetic Related Information Source (IRIS)

- 训练集
  - easy_input_expr.txt，表达谱
  - easy_input_surv.txt，生存数据

- 测试集，GEO数据的下载及数据预处理请参考FigureYa203ComBat，其余测试集如法炮制
  - easy_validation_expr.txt，表达谱
  - easy_validation_surv.txt，生存数据

# Input files

The expression profile file is large and has been uploaded to the Weiyun <https://share.weiyun.com/0esnGlCh>

- InnateDB_genes.csv, immune gene set. Data from <https://www.innatedb.com/redirect.do?go=resourcesGeneLists> Immunogenetic Related Information Source (IRIS)

- Training sets
- easy_input_expr.txt, expression profile
- easy_input_surv.txt, survival data

- For the test set, please refer to FigureYa203ComBat for downloading GEO data and data preprocessing, and the rest of the test sets are prepared in the same way
- easy_validation_expr.txt, expression profile
- easy_validation_surv.txt, survival data
