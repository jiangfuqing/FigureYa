---
title: "FigureYa197SmoothHaz"
author: "Jiawei Shi"
reviewers: "Ying Ge,Hui Huang"
date: "2025-5-20"
output: html_document
---
# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述
# Description of the requirements

复现平滑化的风险函数曲线（B）
Reproducing the smoothed risk function curve (B)

![](example.png)

出自<https://pubmed.ncbi.nlm.nih.gov/32386405/>
from <https://pubmed.ncbi.nlm.nih.gov/32386405/>

Figure 2: (A) Recurrence-free survival curves according to the presence of MIP component. (B) Smoothed hazard estimates for the presence of MIP component.

图B在例文中多次出现。
Figure B appears several times in the example.

# 应用场景

该图本质上就是一种核密度图。关于核密度图的基础知识可参考底部“附”。

例文应用风险曲线探索手术切除的肺腺癌微乳头这种组织学亚型术后不同时间内的复发风险。

我们用TCGA最新的pancancer临床信息做为输入数据，你可以顺利画出自己感兴趣的癌症的核密度图，展示某一特征随时间的变化。

这种图在更多文章中的应用：

- [Science. 2020;eabd2161.](https://pubmed.ncbi.nlm.nih.gov/32703910/)
- [Nature. 2012;486(7403):395-399. Fig.4C](https://pubmed.ncbi.nlm.nih.gov/22495314/);
- [Oncotarget. 2018;9(87):35742-35751.](https://pubmed.ncbi.nlm.nih.gov/30515266/)
- [JAMA Oncol. 2018;4(3):309-315.](https://pubmed.ncbi.nlm.nih.gov/29270608/)
- 本次复现的图参考[Neuro Oncol. 2015 Jul;17(7):999-1006.](https://pubmed.ncbi.nlm.nih.gov/25688120/)

# Application Scenarios
This plot is fundamentally a kernel density plot. For foundational concepts of kernel density estimation, refer to the Appendix.

Example Use Case:
The original study employed risk curves (a specialized kernel density visualization) to explore recurrence risks over time in the micropapillary histological subtype of resected lung adenocarcinoma.

Workflow Adaptation:
Using the latest TCGA pan-cancer clinical data as input, you can generate kernel density plots for any cancer type of interest to visualize temporal changes in specific biological or clinical features.

Additional Literature Applications:
For extended implementations of this visualization approach in peer-reviewed studies, see:

- [Science. 2020;eabd2161.](https://pubmed.ncbi.nlm.nih.gov/32703910/)
- [Nature. 2012;486(7403):395-399. Fig.4C](https://pubmed.ncbi.nlm.nih.gov/22495314/);
- [Oncotarget. 2018;9(87):35742-35751.](https://pubmed.ncbi.nlm.nih.gov/30515266/)
- [JAMA Oncol. 2018;4(3):309-315.](https://pubmed.ncbi.nlm.nih.gov/29270608/)
- Diagram reference for this reproduction: [Neuro Oncol. 2015 Jul;17(7):999-1006.](https://pubmed.ncbi.nlm.nih.gov/25688120/)


# 环境设置
# Environment settings


```{r}
source("install_dependencies.R")
```

```{r eval=FALSE}

install.packages("muhaz")
install.packages("export")

#下载export，https://cran.r-project.org/src/contrib/Archive/export/
#Download export，https://cran.r-project.org/src/contrib/Archive/export/
#安装依赖的包
#Install the dependent packages
install.packages(c("rvg", "flextable", "rgl", "stargazer"))
#本地安装export
#Install export locally
install.packages("export_0.2.2.tar.gz", repos = NULL, type = "source")
```

加载包
load package

```{r}
library(survival)
library(survminer)# 生存分析 # Survival analysis
library(openxlsx) # 读取数据 # Read the data
library(muhaz)    # 风险评估 # risk assessment
library(dplyr)    # 数据清洗 # Data cleansing
library(ggplot2)  # 绘图 # plot
library(cowplot)  # 拼图 # jigsaw puzzle
Sys.setenv(LANGUAGE = "en") #显示英文报错信息 # error messages are displayed in English
options(stringsAsFactors = FALSE) #禁止chr转成factor # It is forbidden to convert chr into factor
```

# 输入文件的获得

如果你的数据已整理成`easy_input.csv`的格式，就跳过这步，直接进入“构建muhaz对象”。

input.xlsx，是TCGA最新的pancancer临床数据，出自[Cell. 2018;173(2):400-416.e11.](https://pubmed.ncbi.nlm.nih.gov/29625055/)的[补充材料](https://ars.els-cdn.com/content/image/1-s2.0-S0092867418302290-mmc1.xlsx)

后面将以性别gender作为分组举例子，实际分析时，把gender替换为你感兴趣的特征对应在panclin里的列名。或者把你经过其他分析获得的分类信息作为一列添加进去。

# Obtaining Input Files
If your data is already formatted as easy_input.csv, skip this step and proceed directly to the Build muhaz Object section.

# Data Source
input.xlsx: Contains the latest TCGA pan-cancer clinical data sourced from the Supplementary Materials of the publication:[Cell. 2018;173(2):400-416.e11.](https://pubmed.ncbi.nlm.nih.gov/29625055/)[supplyment material](https://ars.els-cdn.com/content/image/1-s2.0-S0092867418302290-mmc1.xlsx)

Gender will be used as an example of grouping, and in the actual analysis, replace gender with the feature you are interested in corresponding to the list name in the panclin. Or add the classification information you've obtained through other analyses as a column.
