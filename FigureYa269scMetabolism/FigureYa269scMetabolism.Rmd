---
title: "FigureYa269scMetabolism"
author: "小丫画图出品"
date: "2022-3-18"
output: html_document
---
欢迎关注“小丫画图”公众号，回复“小白”，看小视频，实现点鼠标跑代码。

小丫微信: epigenomics  E-mail: figureya@126.com

作者：古潇，他的更多作品看这里<https://k.koudai.com/uH4zuEWC>

小丫编辑校验

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述

用scMetabolism实现单细胞RNA-seq数据的代谢分析，并画图。

![](example.png)

出自<https://aacrjournals.org/cancerdiscovery/article/12/1/134/675646/Spatiotemporal-Immune-Landscape-of-Colorectal>

Figure 4.  MRC1+ CCL18+ macrophages in metastatic tumors showed high metabolic activity.
C, The heat map of average metabolic gene expression and median metabolic pathway score of MRC1+ CCL18+ macrophages. The genes highlighted with red represent the potential druggable genes (Methods).

# 应用场景

Mining metabolic activity at single-cell resolution，为了方便使用，例文作者把整个pipeline写成了R包scMetabolism。还开发了在线版<http://www. cancerdiversity.asia/scMetabolism/>。

本文档带你跑通R版本的scMetabolism，适用于scRNA-seq数据，友好对接seurat。

另外，原文作者也在“小丫画图群-\*”里，如果您对该文章的其他图/分析过程感兴趣，欢迎找小丫提需求，下次请原文作者分享。

# 环境设置


```{r}
source("install_dependencies.R")
```

```{r eval=FALSE}

install.packages("magrittr")
install.packages("devtools")
devtools::install_github('satijalab/seurat-data',force = TRUE)

### 安装scMetabolism计算代谢通路
# 如果安装不成功，先去升级R
# 先安装依赖包
install.packages("BiocManager")
BiocManager::install(c("AUCell", "GSEABase", "GSVA"))
install.packages("phangorn")
devtools::install_github("YosefLab/VISION")
devtools::install_github("wu-yc/scMetabolism")

BiocManager::install("clusterProfiler")
```

加载包

```{r}
library(Seurat)
library(SeuratData)
library(patchwork)
library(RColorBrewer)
library(pheatmap)
library(dplyr)
library(magrittr)
library(scMetabolism)
library(ggplot2)
library(rsvd)

Sys.setenv(LANGUAGE = "en") #显示英文报错信息
options(stringsAsFactors = FALSE) #禁止chr转成factor
```

# 输入文件预处理

跟FigureYa267scCellChat一样的处理，可以直接跳到“Metabolic genes”。

`ifnb` - A Seurat object with the PBMC control/IFNB-stimulated dataset。出自<https://pubmed.ncbi.nlm.nih.gov/29227470/>，已被打包到SeuratData里，我们直接安装、加载它。

示例数据ifnb有STIM和CTRL两组：

- 先拆分成两个seurat object，对两个数据集单独进行normalize并识别各自的高变异基因，使用高变异基因在两个基因集中分别执行PCA。
- 然后对两个数据集进行整合，进行常规数据预处理，存入immune.combined，以便进行后续分析。
