---
title: "FigureYa259circLink"
params:
  author: "Zongcheng Li; Yasi Zhang"
  reviewer: "Ying Ge"
  date: "2025-05-20"
output: html_document
---

**Author(s)**: `r params$author`
**Reviewer(s)**: `r params$reviewer`
**Date**: `r params$date`

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述
# Demand description

画出这种连线图。

Draw this connection diagram.

![](example1.png)

出自：<https://molecular-cancer.biomedcentral.com/articles/10.1186/s12943-021-01322-w>，跟FigureYa260CNV出自同一篇文章

图5 与WM评分相关的转录及转录后调控特征。
a TCGA-COAD/READ队列中WM评分高/低组间miRNA靶向信号通路的差异。红线表示高WM评分组中低表达的miRNA，蓝线表示低WM评分组中高表达的miRNA。红点对应高WM评分组中高表达的miRNA靶基因，蓝点对应低WM评分组中高表达的miRNA靶基因。圆圈代表靶基因富集的信号通路。

Source: <https://molecular-cancer.biomedcentral.com/articles/10.1186/s12943-021-01322-w>, from the same article as FigureYa260CNV.

Fig. 5 Transcriptional and post-transcriptional characteristics associated with the WM_Score.
a Differences in miRNA-targeted signaling pathways in the TCGA-COAD/READ cohort between the WM_Score-high and -low groups. The red line represents a low expression of miRNA in the high WM_Score group, and the blue line represents a high expression of miRNA in the low WM_Score group. Red dots correspond to miRNA-targeted genes highly expressed in the high WM_Score group, and blue dots correspond to miRNA-targeted genes highly expressed in the low WM_Score group. The circle represents a signaling pathway enriched with targeted genes.

类似的图：

A similar image:

![](example2.png)

出自：<https://doi.org/10.1038/s42255-019-0045-8>，跟FigureYa174squareCross、FigureYa199crosslink、FigureYa256panelLink出自同一篇文章。这篇文章以连线著称，总是被模仿，不知道会不会被超越。

图3 | 倾向性评分算法概述及跨癌种低氧相关分子模式。
c图展示1,074个癌细胞系中低氧相关基因mRNA表达水平与药物敏感性之间的斯皮尔曼等级相关性。x轴上的深绿色圆点代表低氧相关基因；橙色圆点表示按不同信号通路聚类的药物。橙色圆点的大小反映与药物敏感性相关基因的数量（|rs| > 0.3且FDR < 0.05）；条形图显示与基因存在相关性的药物数量。粉色与青色线条分别表示正相关与负相关。JNK指Jun N末端激酶。

Source: <https://doi.org/10.1038/s42255-019-0045-8>, from the same article as FigureYa174squareCross, FigureYa199crosslink, and FigureYa256panelLink. This paper is renowned for its connection designs—constantly imitated, yet to be surpassed.

Fig. 3 | overview of the propensity score algorithm and the hypoxia-associated molecular patterns across cancer types.
c, Association between mRNA expression levels of hypoxia-associated genes and drug sensitivity across 1,074 cancer cell lines by Spearman’s rank correlation. The dark green dots along the x axis indicate hypoxia-related genes; the orange dots denote drugs that are clustered by different signalling pathways. The size of the orange dot indicates the number of genes correlated with drug sensitivity (|rs| > 0.3, FDR < 0.05); the bar plot shows the number of drugs correlated with the genes. The pink and cyan lines indicate positive and negative correlation, respectively. JNK, Jun N-terminal kinase.

# 应用场景
# Application scenarios

展示miRNA-靶基因（或基因-药物等）的关系，连线和节点的颜色代表节点类型（例如例文的high和low WM_Score）。同一通路的基因画在同一圆圈里，并标注通路名。

为了画这个图，完善了crosslink包，该R包会继续添加更多有趣的连线功能，感兴趣可前往<https://github.com/zzwch/crosslink>查看最新版本及功能，在github上还能提交issue跟作者直接交流。

This figure displays miRNA-target gene (or gene-drug, etc.) relationships, where the colors of connecting lines and nodes represent node types (e.g., high vs. low WM_Score as shown in the example). Genes from the same pathway are grouped within circular clusters labeled with pathway names.

To create this visualization, we enhanced the crosslink R package, which will continue to incorporate more innovative connection features. Those interested can visit <https://github.com/zzwch/crosslink> to explore the latest version and functionalities. GitHub also allows users to submit issues for direct communication with the author.

# 环境设置
# Environment Setup


```{r}
source("install_dependencies.R")

# 安装crosslink（确保按照最新版本）
# Install crosslink (ensure you're using the latest version)
# remotes::install_github("zzwch/crosslink", build_vignettes = TRUE)
```

# 加载包
# Loading packages

```{r}
library(magrittr)
library(tidyverse)
library(ggplot2)
library(crosslink)

# 显示英文报错信息
# Show English error messages
Sys.setenv(LANGUAGE = "en")

# 禁止chr转成factor
# Prevent character-to-factor conversion
options(stringsAsFactors = FALSE)
```

# 输入文件
# Input Files

easy_input_links.csv，连线表示source（miRNA）和target（靶基因）的关系。连线的颜色表示source的类型source_type（high WM_Score和low WM_Score）。

easy_input_nodes.csv，key（包括source和target）所在的path（通路）信息。

- 节点的颜色表示target的类型type（high WM_Score和low WM_Score）。
- source（miRNA）的path列写为source，source的type列是source的type，因此跟easy_input_links.csv的source_type列一致，signif列的内容会标在图中source的名字下面。
- 如果想要例文2那样的效果，用target节点的大小表示number of genes correlated to drug sensitivity，就加一列size，用于控制targe节点的大小，记得把文档中`# size = size`前面的`#`删掉。

easy_input_links.csv represents the relationship between the source (miRNA) and the target (target gene), where the color of the line indicates the type of the source (source_type: high WM_Score and low WM_Score).

easy_input_nodes.csv contains the pathway information (path) for the keys (including both source and target).

- The color of the nodes represents the type of the target (type: high WM_Score and low WM_Score).
- For the source (miRNA), the path column should be labeled as "source," and the type column corresponds to the source's type, which should match the source_type column in easy_input_links.csv. The content of the signif column will be displayed below the name of the source in the diagram.
- If you want an effect similar to Example 2, where the size of the target nodes represents the "number of genes correlated to drug sensitivity," add a column named "size" to control the size of the target nodes. Remember to remove `#` in `# size = size` in the document.

```{r}
links <- read.csv("easy_input_links.csv")
nodes <- read.csv("easy_input_nodes.csv")

# 获取所有通路的名字
# Get all pathway names
paths <- unique(nodes[nodes$path != "source", ]$path)

# 把"source"排在前面
# Place "source" first
nodes$path <- factor(nodes$path, levels = c("source", paths))

# 连线的颜色
# Line colors
src_up_col <- "red"
src_dn_col <- "blue"

# target节点的颜色
# Target node colors
tar_up_col <- "red"
tar_dn_col <- "blue"
```

# 开始画图
# Plotting

## 1. 快速预览
## 1. Take a glance

> 重要提示！节点和边数据中不能包含列名 'node'、'cross'、'node.type'、'x'、'y'、'degree'！

> IMPORTANT! The colnames of 'node', 'cross', 'node.type', 'x', 'y', 'degree' MUST NOT BE included in nodes and edges!
