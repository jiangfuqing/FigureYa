---
title: "FigureYa61 GSVA"
author: "小丫画图出品"
date: "2018-12-17"
output: html_document
---
微信ID: epigenomics  E-mail: figureya@126.com

作者：[Yu Sun](https://icannotendure.space/en/)，小丫

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 需求描述

模仿paper里方法做GSVA，结果保存到文件，能作为FigureYa39bar的输入文件画出bar plot。

![](example.png)

出自<https://www.nature.com/articles/s41591-018-0096-5/>

## 应用场景

关于GSVA分析，可以这样理解：如果说表达矩阵反映了样本和基因的关系，则GSVA将一个“样本×基因”的矩阵转化为“样本×通路”的矩阵，直接反映了样本和读者感兴趣的通路之间的联系。因此，如果用limma包做差异表达分析可以寻找样本间差异表达的基因，同样地，使用limma包对GSVA的结果（依然是一个矩阵）做同样的分析，则可以寻找样本间有显著差异的通路。这些“差异表达”的通路，相对于基因而言，更加具有生物学意义，更具有可解释性，是统计学与生物学成功结合后，对GSEA结果的一次升华，可以进一步用于肿瘤subtype的分型等等与生物学意义结合密切的探究。

示例文件easy_input_expr.csv跟FigureYa59volcano用的是同一套表达数据。

- FigureYa59volcano的输入文件easy_input_limma.csv是用**全体基因**做差异分析获得的。
- 此处gsva_limma.csv文件是用**通路**做差异分析获得的。

## 环境设置

### 安装包

```r

install.packages("msigdbr")
```

### 加载包

```{r}
source("install_dependencies.R")
library(msigdbr)
library(dplyr)
library(data.table)
library(GSVA)
library(limma)
library(stringr)
library(ggplot2)

Sys.setenv(LANGUAGE = "en") #显示英文报错信息
options(stringsAsFactors = FALSE) #禁止chr转成factor
# options(mc.cores = parallel::detectCores())
```

## 输入文件

GSVA需要两个输入文件：基因表达矩阵和通路里的基因列表。

- hallmark.gs.RData：“整理通路里的基因列表”这部分生成的，同一物种同一版本注释可重复使用。

- easy_input_expr.csv：基因表达矩阵，每行一个基因，每列一个sample。

## 整理通路里的基因列表

下面这部分运行后，要保存好生成的hallmark.gs.RData文件，同一物种同一版本注释可重复使用。以后就可以跳过这步，直接进入“GSVA”。

**每次只需要更换表达矩阵，用同一物种同一版本gmt生成的"hallmark.gs.RData"可以一直用。**

为了减少冗余信息的干扰，paper中要求：

- 在每个geneset中，不应该出现重复的基因；
- 在两个或更多个pathway中出现的基因应该被彻底剔除。

在实际分析过程中，笔者留意到在单个的geneset中已经很少出现重复的基因，但在两个或更多个pathway中出现的基因则数目相对较多，读者可**酌情考虑，调整此处过滤的力度**。
