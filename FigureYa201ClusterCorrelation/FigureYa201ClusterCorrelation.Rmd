---
title: "FigureYa201ClusterCorrelation"
author: "Xiaofan Lu"
reviewers: "Ying Ge,Hui Huang"
date: "2025-5-20"
output: html_document
---
# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述

根据基因表达进行非监督聚类，之后划分为正负相关基因集。

# Requirement Description

Unsupervised clustering was performed based on gene expression, after which it was divided into positive and negatively correlated gene sets.

![](example.png)

出自<https://www.cell.com/molecular-therapy-family/nucleic-acids/fulltext/S2162-2531(20)30259-6>
from<https://www.cell.com/molecular-therapy-family/nucleic-acids/fulltext/S2162-2531(20)30259-6>

Figure 2. Identification of Immunogenic Gene Subtypes
A) Unsupervised clustering of common DEGs among three ICI cluster groups to classify patients into three groups: gene clusters A–C.

# 应用场景

根据基因表达进行非监督共识聚类，划分正负相关基因集。

# Application Scenarios

Unsupervised consensus clustering was performed based on gene expression, and positive and negative correlation gene sets were divided.

FigureYa154immuneSubtypes和FigureYa202consensusGene也用到了ConsensusClusterPlus做共识聚类，可相互参考，灵活运用，设计出更有趣的展示方式。

FigureYa154immuneSubtypes and FigureYa202consensusGene also use ConsensusClusterPlus for consensus clustering, which can be used for mutual reference and flexible use to design more interesting display methods.

> “小丫画图群-数据处理”里的小伙伴CR问：“什么叫非监督共识聚类？”

ConsensusClusterPlus包的描述：ConsensusClusterPlus function for determing cluster number and class membership by stability evidence.

大鱼海棠作出以下解答：

- **共识聚类**是对原数据集重新抽样，对抽样子集做聚类。
  - **多次重复**来评估样本同属于相同类的概率，这种是常用的consensus clustering。
  - 用**不同算法**聚类来综合结果是另一种共识，这个一般叫consensus ensemble。后者属于later integration后期整合的一种。

- **非监督**就是在你并不知道有多少类的情况下，没有目的的进行聚类，然后根据一些统计量确定最优结果。
- 当你有了一些先验知识，有目的的进行聚类分析，一般是在某个感兴趣的数据集上直接明确聚类数目就是**监督聚类**了。

# What is Unsupervised Consensus Clustering?
Here’s my explanation:

**Consensus Clustering** involves resampling the original dataset and performing clustering on subsets.

**Repeated iterations** assess the probability that samples consistently belong to the same class—this is the classic consensus clustering approach.

**Combining results from different clustering algorithms** is another form of consensus, typically called consensus ensemble clustering. The latter falls under late integration in multi-method workflows.

**Unsupervised** means clustering without prior knowledge of the number of classes, then determining the optimal result based on statistical metrics (e.g., consensus scores, silhouette width).

When prior knowledge guides the analysis (e.g., a predefined cluster number in a target dataset), it becomes **supervised clustering**.

# 环境设置


# Environment settings


```{r}
source("install_dependencies.R")

```

加载包
load packages

```{r}
library(ConsensusClusterPlus)
library(pheatmap)

Sys.setenv(LANGUAGE = "en") #显示英文报错信息 # Display English error messages
options(stringsAsFactors = FALSE) #禁止chr转成factor # Prohibit converting chr to factor
```

# 输入文件


easy_input_expr.txt，包含目标基因的表达矩阵，将从这里提取目标基因的表达矩阵。

easy_input_cli.txt，样本信息，画热图时用颜色标注样本信息。每个sample为一行，每列为一种信息，这里用到性别Gender、生存状态Status、分期Grade、年龄Age。**如果你不想在图中标注样本信息，就不需要这个文件。**

easy_input_gene.txt, 目标基因，用来聚类和画图，来自原文Table S2的三个亚型的差异表达基因，取并集。

# File Descriptions

-easy_input_expr.txt

Contains the expression matrix of target genes.This file will be used to extract the expression profiles of the specified genes.

-easy_input_cli.txt

Stores sample metadata for heatmap annotation (e.g., color-coding by clinical features).Format: Each row represents a sample; columns represent attributes (e.g., Gender, Status, Grade, Age).Note: Optional—omit this file if sample annotation is not required in the visualization.

-easy_input_gene.txt

Lists target genes for clustering and plotting.Derived from the union of differentially expressed genes (DEGs) across three subtypes in Table S2 of the original publication.
