---
title: "FigureYa81immune_network"
author: "Dongqiang Zeng, Taojun Ye"
reviewer: "Ying Ge"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# 设置knitr的全局代码块选项 / Set global chunk options for knitr
```

## 需求描述

复现原文免疫细胞之间相关性的网络图

## Requirement description

Reproduce the network diagram of the correlation between immune cells in the original text

![](example.png)

出自<http://cancerimmunolres.aacrjournals.org/content/early/2019/03/06/2326-6066.CIR-18-0436>

from<http://cancerimmunolres.aacrjournals.org/content/early/2019/03/06/2326-6066.CIR-18-0436>

节点的颜色代表细胞所属的cluster，节点的大小代表生存分析的log_rank_p，用圆心点的颜色展示HR，连线颜色代表正/负相关，连线的粗细代表相关性Pvalue。

The color of the node represents the cluster to which the cell belongs, the size of the node represents the log_rank_p of survival analysis, HR is displayed using the color of the center point, the color of the connecting line represents positive/negative correlation, and the thickness of the connecting line represents correlation Pvalue.

## 应用场景

用网络图同时展示相关关系、pvalue、聚类/分类结果、跟预后的关系。

- 例如例文中各细胞之间的相关关系、跟预后的关系
- 或表达谱数据中多个基因的相关性、聚类结果、pvalue、跟预后的关系，比FigureYa37correlation更丰富。

**画法说明：**

- 用代码画出例图中除圆心以外的部分。
- 再根据“output_HR_corlor.csv”的最后一列，用Illustrator在圆心上画点，点的颜色代表HR的正负。
- 最后输出的pdf文件是矢量图，可以用Illustrator等软件调整细胞名等文字的位置。

## Application scenarios

Using a network diagram to simultaneously display relevant relationships pvalue、 The relationship between clustering/classification results and prognosis.

-For example, the correlation between cells in the example text and their relationship with prognosis
-Or the correlation and clustering results of multiple genes in the expression profile data pvalue、 The relationship with prognosis is richer than the correlation shown in Figure Ya37.

**Painting Description:**

-Draw the parts of the example diagram except for the center using code.
-Based on the last column of 'outputting _ HR-color. csv', use Illustrator to draw a point on the center of the circle, with the color of the point representing the positive or negative sign of HR.
-The final output PDF file is a vector image, which can be adjusted using software such as Illustrator to position text such as cell names.

## 环境设置

## Environment settings

```{r}
source("install_dependencies.R")
# 加载数据处理和可视化所需的包 | Load packages for data processing and visualization
library(reshape2)     # 用于数据重塑 | For data reshaping
library(corrplot)     # 用于绘制相关性热图 | For correlation matrix visualization
library(plyr)         # 用于数据操作和聚合 | For data manipulation and aggregation
library(igraph)       # 用于绘制网络图 | For network graph visualization

# 设置环境和选项 | Set environment and options
Sys.setenv(LANGUAGE = "en")           # 设置显示英文报错信息 | Set error messages to English
options(stringsAsFactors = FALSE)     # 禁止将字符型变量自动转换为因子 | Disable automatic conversion of strings to factors
```

## 参数设置

## Parameter settings
