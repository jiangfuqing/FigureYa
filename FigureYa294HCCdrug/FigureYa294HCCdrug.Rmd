---
title: "FigureYa294HCCdrug"
params:
  author: "Xiaofan Lu; Yasi Zhang"
  reviewer: "Ying Ge"
  date: "2025-05-20"
output: html_document
---

**Author(s)**: `r params$author`
**Reviewer(s)**: `r params$reviewer`
**Date**: `r params$date`

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述
# Demand description

希望复现这篇文章的Figure 4DE。

We hope to reproduce Figure 4DE of this article.

![](example.png)

出自：<https://academic.oup.com/bib/article-abstract/22/3/bbaa164/5891146?redirectedFrom=fulltext&login=false>

图4. PPS相关生物学过程及药物靶点的鉴定。
(D) 火山图（左）和散点图（右）展示了PPS评分与药物靶点蛋白表达的Spearman相关性及显著性（另见在线表格S11，链接：https://academic.oup.com/bib）。红点表示显著正相关（P < 0.05且Spearman’s r > 0.3）。
(E) 火山图（左）和散点图（右）展示了PPS评分与药物靶点CERES评分的Spearman相关性及显著性（另见在线表格S11，链接：https://academic.oup.com/bib）。蓝点表示显著负相关（P < 0.05且Spearman’s r < −0.5）。散点图中标注了TP53突变型肝癌细胞系。

复现方法：Yang C, Huang X, Li Y, Chen J, Lv Y, Dai S. Prognosis and personalized treatment prediction in TP53-mutant hepatocellular carcinoma: an in silico strategy towards precision oncology. Brief Bioinform. 2021 May 20;22(3):bbaa164. doi: 10.1093/bib/bbaa164.

开源数据：Gao Q, Zhu H, Dong L, Shi W, Chen R, Song Z, Huang C, Li J, Dong X, Zhou Y, Liu Q, Ma L, Wang X, Zhou J, Liu Y, Boja E, Robles AI, Ma W, Wang P, Li Y, Ding L, Wen B, Zhang B, Rodriguez H, Gao D, Zhou H, Fan J. Integrated Proteogenomic Characterization of HBV-Related Hepatocellular Carcinoma. Cell. 2019 Nov 14;179(5):1240. doi: 10.1016/j.cell.2019.10.038. Erratum for: Cell. 2019 Oct 3;179(2):561-577.e22.

Source: <https://academic.oup.com/bib/article-abstract/22/3/bbaa164/5891146?redirectedFrom=fulltext&login=false>

Figure 4. Identification of PPS-related biological processes and drug targets.
(D) Volcano plot (left) and scatter plots (right) of Spearman’s correlations and significance between PPS scores and protein expression of drug targets (see also Table S11 available online at https://academic.oup.com/bib). Red dots indicate the significant positive correlations (P < 0.05, and Spearman’s r > 0.3).
(E) Volcano plot (left) and scatter plots (right) of Spearman’s correlations and significance between PPS score and CERES score of drug targets (see also Table S11 available online at https://academic.oup.com/bib). Blue dots indicate the significant negative correlations (P < 0.05, and Spearman’s r < −0.5). TP53-mutant hepatoma cell lines are labeled on the scatter plots.

Reproduction method: Yang C, Huang X, Li Y, Chen J, Lv Y, Dai S. Prognosis and personalized treatment prediction in TP53-mutant hepatocellular carcinoma: an in silico strategy towards precision oncology. Brief Bioinform. 2021 May 20;22(3):bbaa164. doi: 10.1093/bib/bbaa164.

Open source data: Gao Q, Zhu H, Dong L, Shi W, Chen R, Song Z, Huang C, Li J, Dong X, Zhou Y, Liu Q, Ma L, Wang X, Zhou J, Liu Y, Boja E, Robles AI, Ma W, Wang P, Li Y, Ding L, Wen B, Zhang B, Rodriguez H, Gao D, Zhou H, Fan J. Integrated Proteogenomic Characterization of HBV-Related Hepatocellular Carcinoma. Cell. 2019 Nov 14;179(5):1240. doi: 10.1016/j.cell.2019.10.038. Erratum for: Cell. 2019 Oct 3;179(2):561-577.e22.

# 应用场景
# Application scenarios

Identification of potential drug targets for high PPS score HCCs
例文前面筛选出PPS genes做分子分型，然后想找high PPS score病人的潜在药物。
自己的数据，可以用感兴趣的基因集替换PPS genes。

例文几个Figure的画法可参考相应的FigureYa：

- Figure 2DE、Fig. S6和Fig. S8C，可参考FigureYa85timeROC<https://k.youshop10.com/4fJSKDPh>
- Figure 3ABC，可参考FigureYa161stemness<https://k.youshop10.com/RS8tccc6>
- Figure 5BC，可参考FigureYa59volcano<https://k.youshop10.com/spa8oEli>
- Fig. S3，可参考FigureYa141risk<https://k.youshop10.com/AV2klAIh>
- Fig. S4B，可参考FigureYa92immune_gene<https://k.youshop10.com/vTNicJZs>，C可参考FigureYa68friends<https://k.youshop10.com/q6wMD-0q>，D可参考FigureYa165heatmapPvalue<https://k.youshop10.com/XxLAKutg>
- Fig. S5，可参考FigureYa30nomogram<https://k.youshop10.com/oBlq8jMz>，FigureYa138NiceCalibration<https://k.youshop10.com/Yyz4NqZl>

- FigureYa227boxdensity<https://k.youshop10.com/C2UZUXzD>复现了Figure 5D，展示两组之间对于索拉菲尼药物治疗敏感性的差异。
- FigureYa212drugTarget<https://k.youshop10.com/gYOKpSA5>复现了Figure 5FG，利用细胞系表达谱（CCLE）及药敏结果（PRISM和CTRP），预测癌症样本的药敏结果。
- FigureYa213customizeHeatmap<https://k.youshop10.com/ERfoCk=->复现了Figure 6，实现CMap analysis及画图。

Identification of potential drug targets for high PPS score HCCs
The previous analysis screened PPS genes for molecular subtyping, and now aims to identify potential drugs for patients with high PPS scores.
For your own data, you can replace PPS genes with gene sets of interest.

The following figures from the example paper can be reproduced using the corresponding FigureYa tools:

- Figure 2DE, Fig. S6, and Fig. S8C: Refer to FigureYa85timeROC <https://k.youshop10.com/4fJSKDPh>
- Figure 3ABC: Refer to FigureYa161stemness <https://k.youshop10.com/RS8tccc6>
- Figure 5BC: Refer to FigureYa59volcano <https://k.youshop10.com/spa8oEli>
- Fig. S3: Refer to FigureYa141risk <https://k.youshop10.com/AV2klAIh>
- Fig. S4B: Refer to FigureYa92immune_gene <https://k.youshop10.com/vTNicJZs>;
C: Refer to FigureYa68friends <https://k.youshop10.com/q6wMD-0q>;
D: Refer to FigureYa165heatmapPvalue <https://k.youshop10.com/XxLAKutg>
- Fig. S5: Refer to FigureYa30nomogram <https://k.youshop10.com/oBlq8jMz> and FigureYa138NiceCalibration<https://k.youshop10.com/Yyz4NqZl>

- FigureYa227boxdensity<https://k.youshop10.com/C2UZUXzD> reproduces Figure 5D, showing differences in sensitivity to sorafenib treatment between two groups.
- FigureYa212drugTarget<https://k.youshop10.com/gYOKpSA5> reproduces Figure 5FG, predicting drug sensitivity in cancer samples using cell line expression profiles (CCLE) and drug response data (PRISM and CTRP).
- FigureYa213customizeHeatmap<https://k.youshop10.com/ERfoCk=-> reproduces Figure 6, performing CMap analysis and visualization.

# 环境设置
# Environment Setup


```{r}
source("install_dependencies.R")

```

# 加载包
# Loading packages

```{r}
library(readr)
library(ggplot2)
library(ggrepel)
library(cowplot)

# 显示英文报错信息
# Show English error messages
Sys.setenv(LANGUAGE = "en")

# 禁止chr转成factor
# Prevent character-to-factor conversion
options(stringsAsFactors = FALSE)
```

# 输入文件
# Input Files

例文补充材料中的特征已整理到txt文件中，便于套用。

The features from the supplementary materials of the example paper have been compiled into a txt file for easy application.

## 药物靶点信息
## Drug Target Information

来自例文补充材料Table S10，是例文作收集的target information of 6125 compounds。用到自己的文章里，记得引用例文哦～

From Table S10 of the supplementary materials of the example paper, this is the target information of 6,125 compounds collected by the authors. If you use it in your own paper, remember to cite the example paper~

```{r}
Tinfo <- read.delim("table s10 target.txt",sep = "\t",row.names = NULL,header = T,check.names = F,stringsAsFactors = F)
```

## 特征基因集（以例文的PPS genes为例）
## Feature Gene Set (Using the PPS Genes from the Example Paper as an Example)

实际应用时，替换为自己感兴趣的基因集。

In practical applications, replace it with your gene set of interest.
