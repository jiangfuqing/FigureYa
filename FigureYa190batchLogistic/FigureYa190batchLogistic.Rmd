---
title: "FigureYa190batchLogistic"
author: "Xiaofan Lu"
reviewer: "Ying Ge, Junyi Shen"
date: "2025-5-20"
output: html_document
---
# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述

# Requirement

逻辑回归，这篇文章应该是一个一个做的，我主要想要的是批量。
Logistic regression. This article should be done one by one. What I mainly want is batch production.

![](example.png)

出自<https://doi.org/10.1371/journal.pone.0201515>
fromhttps://doi.org/10.1371/journal.pone.0201515

# 应用场景

# Application Scenarios

批量计算单变量和多变量逻辑回归。
Batch calculation of univariate and multivariate logistic regression.

这个是逻辑回归，如果要cox回归，可参考FigureYa47HR2table。
This is logistic regression. If you want cox regression, you can refer to Figure A47HR2Table.

# 环境设置

# Environment Setup


```{r}
source("install_dependencies.R")
```

```{r eval=FALSE}

install.packages("SimDesign")
```

加载包
Loading package

```{r}
library(SimDesign) # 用于沉默逐步回归的信息 # Information for silent stepwise regression

Sys.setenv(LANGUAGE = "en") #显示英文报错信息  # displays an English error message
options(stringsAsFactors = FALSE) #禁止chr转成factor   # prohibit chr from being converted to factor
```

# 输入文件

# Input File

easy_input.csv，每行一个sample，第一列就是sample ID，第二列为分组（响应变量），其后每列一个特征（自变量）。这里是基因的表达量，可以换其他临床信息。
easy_input.csv, each row contains a sample. The first column is the sample ID, the second column is the group (response variable), and each subsequent column contains a feature (independent variable). Here is the expression level of the gene, which can be replaced with other clinical information.

```{r}
dat <- read.table("easy_input.txt",row.names = 1,sep = "\t",header = T,check.names = F,stringsAsFactors = F)
dat[1:3, 1:3]
table(dat$MetaStatus)

# 注意，如果变量是基因，一定要把“-”替换成别的符号比如“_”。
# Note that if the variable is a gene, the "-" must be replaced with another symbol, such as "_".
colnames(dat) <- gsub("-","_",colnames(dat))
```

# 循环运算单变量逻辑回归

# Loop operation for univariate logistic regression

```{r}
rname <- "MetaStatus" #设置响应变量y的变量名  # Set the variable name of the response variable y
vname <- setdiff(colnames(dat), rname) # 设置自变量x的变量名  # sets the variable name of the independent variable x

# 初始化结果向量 # Initialize the result vector
or <- p <- p.lab <- c()
p.cutoff <- 0.05 # 名义p值的阈值   # The threshold of nominal p value
step.dir <- "forward" # 逐步回归的方向，可为backward，forward和both，例文为forward  # The direction of stepwise regression can be backward, forward, or both. The example text is forward

for (v in vname) {
  f <- as.formula(paste0(rname,"~",v)) # 创建公式  # Create Formulas
  t <- dat[,c(rname,v)]

  # 单变量逻辑回归
  # Univariate Logistic regression
  l <- glm(f,
           data = t,
           family = "binomial",
           control = list(maxit = 50),
           na.action = na.exclude)

  s <- format(round(exp(cbind("OR" = coef(l), confint.default(l, level = 0.95)))[2,],3),nsmall = 3) # 调整格式  # Adjust Format
  s <- paste0(s[1]," (",s[2],"-",s[3],")")
  or <- c(or,s) # odd ratio
  p <- c(p,format(round(summary(l)$coefficients[2,4],3),nsmall = 3))
  p.lab <- c(p.lab, # 名义p值的标签  # Nominal P-value label
             ifelse(summary(l)$coefficients[2,4] < 0.001,
                    "<0.001", format(round(summary(l)$coefficients[2,4],3),nsmall = 3)))
}
```

# 多变量回归

# Multivariate regression
