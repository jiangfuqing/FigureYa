---
title: "FigureYa105GDSC"
author: "Xiaofan Lu, Taojun Ye"
reviewer: "Ying Ge"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# 使用knitr包设置全局代码块选项
# Set global chunk options using knitr package
```

## 需求描述

利用pRRophetic算法，根据GDSC<www.cancerrxgene.org/>细胞系表达谱和TCGA基因表达谱构建岭回归模型预测药物IC50（使用原文数据，复现原图）

提示：pRRophetic的示例可参考：https://github.com/paulgeeleher/pRRophetic/blob/master/vignetteOutline.pdf

## Requirement description

Using the pRRophetic algorithm, a ridge regression model was constructed based on the expression profiles of GDSC<www.cancerrxgene. org/>cell lines and TCGA gene expression profiles to predict drug IC50 (using the original data and reproducing the original image)

Tip: For an example of pRRophetic, please refer to: https://github.com/paulgeeleher/pRRophetic/blob/master/vignetteOutline.pdf

![](example.png)

出自<https://www.sciencedirect.com/science/article/pii/S1476558619301307>

from<https://www.sciencedirect.com/science/article/pii/S1476558619301307>

**注意：**由于包含原文数据，若涉及到注释文件亚型及其他相关数据的使用，请引用：
Lu X, Jiang L, Zhang L, et al. Immune Signature-Based Subtypes of Cervical Squamous Cell Carcinoma Tightly Associated with Human Papillomavirus Type 16 Expression, Molecular Features, and Clinical Outcome[J]. Neoplasia, 2019, 21(6): 591-601.

**Note: * * Due to the inclusion of original data, if it involves the use of annotation file subtypes and other related data, please cite:
Lu X, Jiang L, Zhang L, et al. Immune Signature-Based Subtypes of Cervical Squamous Cell Carcinoma Tightly Associated with Human Papillomavirus Type 16 Expression, Molecular Features, and Clinical Outcome[J]. Neoplasia, 2019, 21(6): 591-601.

## 应用场景

预测病人对药物的IC50，画box plot图对比不同分组。

还可以通过批量计算，筛选出组间差异显著的药物。

## Application scenarios

Predict the IC50 of the patient for the drug and draw a box plot to compare different groups.

It is also possible to screen drugs with significant differences between groups through batch calculations.

## 环境设置


## Environment settings


```r

BiocManager::install(c("car", "ridge", "preprocessCore", "genefilter", "sva"))
```

GDSC数据库里的内容可以用R包pRRophetic来访问和计算。

<!-- 点击链接下载pRRophetic_0.5.tar.gz：<https://osf.io/dwzce/?action=download>，然后本地安装。 -->
# 上述链接的R包有误，有问题，如要用pRRophetic包请用果子公众号更新维护版本<https://github.com/ixxmu/mp_duty/issues/2691>
# The R package of the above link is incorrect. If you want to use the pRRophic package, please update the maintenance version with the fruit official account< https://github.com/ixxmu/mp_duty/issues/2691 >

加载包

The content in the GDSC database can be accessed and calculated using the R package pRRophetic.

Click on the link to download pRRophetic_0.5.tar.gz:< https://osf.io/dwzce/?action=download >Then install it locally.

Load Package

```{r}
source("install_dependencies.R")
install.packages("./pRRophetic 2/resource/pRRophetic_Guozi/", repos = NULL,type = "source")
# 加载pRRophetic包，用于药物反应预测和分析
# Load the pRRophetic package for drug response prediction and analysis
library(pRRophetic)

# 加载ggplot2包，用于创建优雅的统计图形
# Load the ggplot2 package for creating elegant statistical graphics
library(ggplot2)

# 加载cowplot包，用于组合和排列ggplot图形
# Load the cowplot package for combining and arranging ggplot graphics
library(cowplot)

# 设置环境语言为英文，使报错信息以英文显示
# Set the environment language to English to display error messages in English
Sys.setenv(LANGUAGE = "en")

# 禁止字符串自动转换为因子，保持数据原始格式
# Disable automatic conversion of strings to factors to maintain original data format
options(stringsAsFactors = FALSE)
```

## 输入文件

需要三个文件：表达数据、分组信息和药物名字，前两个文件的sample ID必须一致。

easy_input_expr.txt，基因表达矩阵。

easy_input_anno.txt，分组信息。示例数据里的C1和C2分别对应"HPV16-IMM"和"HPV16-KRT"。也可以是按某个基因的突变类型分组、或按某个基因表达量高低分组。

drug.txt，要计算和画图的药物的名字，药物名必须存在与GDSC数据库中。**具体选哪个药物呢？**可以基于背景知识来选择合适的药物，就像例文那样；也可以批量筛选组间差异显著的药物做深入研究。

getCGPinfo函数内部是2016版药物的名字，共251种；GDSC数据库的网站上2019版的药物名字有266种：<https://www.cancerrxgene.org/translation/Drug#t-all>；然而pRRopheticPredict函数的drug参数the name of the drug for which you would like to predict sensitivity, one of...，其中的药物名字只有138个，下面就对这138种药物进行计算和画图。把pRRopheticPredict函数的drug参数中的药物整理后保存在drug.txt文件中。

## Input file

Three files are required: expression data, grouping information, and drug names. The sample IDs of the first two files must be consistent.

easy_input_expr.txt， Gene expression matrix.

easy_input_anno.txt， Grouping information. C1 and C2 in the example data correspond to "HPV16-IMM" and "HPV16-KRT", respectively. It can also be grouped according to the mutation type of a certain gene, or according to the high or low expression level of a certain gene.

drug.txt， To calculate and plot the names of drugs, the drug names must exist in the GDSC database. **Which medication should be chosen specifically? **Suitable drugs can be selected based on background knowledge, as in the example text; It is also possible to conduct in-depth research by batch screening drugs with significant differences between groups.

The getCGPinfo function contains the names of 251 drugs from the 2016 version; On the website of GDSC database, there are 266 drug names in the 2019 version:< https://www.cancerrxgene.org/translation/Drug#t -all>； However, the drug parameter of the pRRopheticRedis function the name of the drug for which you would like to predict sensitivity, one of...， There are only 138 drug names among them. Below, we will calculate and plot these 138 drugs. Sort and save the drugs in the drug parameter of the pRRopheticRedis function in the drug.exe file.
