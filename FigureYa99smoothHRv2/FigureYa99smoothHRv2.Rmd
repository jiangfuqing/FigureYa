---
title: "FigureYa99smoothHRv2"
author: "Xiaofan Lu, Taojun Ye"
reviewer: "Ying Ge"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# 设置knitr的全局代码块选项 / Set global chunk options for knitr
```

## 需求描述

限制性三次样条插值法（RCS）解决连续性变量对风险的非线性影响。

## Requirement description

Restricted cubic spline interpolation (RCS) is used to address the nonlinear impact of continuous variables on risk.

![](example.png)

出自<https://academic.oup.com/eurheartj/article/39/14/1181/4710060>

from<https://academic.oup.com/eurheartj/article/39/14/1181/4710060>

## 应用场景

1. 连续变量对风险的影响可能是非线性的，忽略这种非线性影响会对结果造成干扰；
2. 量化连续变量对各个取值处，以基线（参考点）为参考时候的风险比。

具体理论推导和细节请见文档中“理论参考”文件夹

## Application scenarios

The impact of continuous variables on risk may be non-linear, and ignoring this non-linear effect can interfere with the results;
2. Quantify the risk ratio of continuous variables at each value point, using the baseline (reference point) as a reference.

Please refer to the "Theoretical References" folder in the document for specific theoretical derivation and details

## 环境设置


## Environment settings


```r

install.packages("smoothHR")
```

加载包

library packages

```{r}
source("install_dependencies.R")
# 加载smoothHR包 - 用于平滑危险比分析
# Load the smoothHR package - used for smooth hazard ratio analysis
library(smoothHR)

# 加载生存分析包 - 提供生存分析所需的核心函数
# Load the survival analysis package - provides core functions for survival analysis
library(survival)

# library(rms) # 用于产生限制性三次样条（注释掉未使用的包）
# library(rms) # Used to generate restricted cubic splines (commented out unused package)

# 加载Hmisc包 - 用于产生限制性三次样条（推荐，参数更精确）
# Load the Hmisc package - used to generate restricted cubic splines (recommended for more accurate parameters)
library(Hmisc)

# 设置环境语言为英文 - 确保报错信息以英文显示
# Set the environment language to English - ensures error messages are displayed in English
Sys.setenv(LANGUAGE = "en")

# 配置选项 - 禁止字符串自动转换为因子类型
# Configure options - disable automatic conversion of strings to factor type
options(stringsAsFactors = FALSE)
```

## 输入文件

easy_input.csv，因为是生存分析的风险计算，所以生存状态（fstat），生存时间（lenfol），以及至少一个协变量（连续变量bmi）是必须的，此处还加了个协变量（二分类变量gender）。

数据来源：smmothHR包自带数据whas500，选了4个变量保存到easy_input.csv文件，便于小伙伴模仿格式。该测试结果仅展示如何对连续变量进行RCS下的Cox回归，无任何临床意义。

具体到实际问题，如果要控制其他因素对风险的影响，就要纳入更多的变量，这个没有固定的。这个众筹只是实现如何利用三次样条量化连续变量对HR的影响，具体要多少变量，具体问题具体分析，毕竟这是一个统计问题，没有通解。

## Input file

easy_input.csv， As it is a risk calculation for survival analysis, survival status (fstat), survival time (lenfol), and at least one covariate (continuous variable BMI) are necessary, and a covariate (binary variable gender) is also added here.

Data source: The smmothHR package comes with the built-in data whas500. Four variables were selected and saved to the easy_input.csv file for easy imitation by users. The test results only demonstrate how to perform Cox regression under RCS for continuous variables and have no clinical significance.

In practical terms, if we want to control the impact of other factors on risk, we need to include more variables, which is not fixed. This crowdfunding is just about how to use cubic spline to quantify the impact of continuous variables on HR, how many variables are needed, and how to analyze the specific problems. After all, this is a statistical problem and there is no general solution.
