---
title: "FigureYa93UMAP"
author: "Zhougeng Xu, Taojun Ye"
reviewer: "Ying Ge"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# 设置knitr的全局代码块选项 / Set global chunk options for knitr
```

## 需求描述

文章里用的是t-SNE，我想用UMAP画这样的图。

t-SNE可参考FigureYa27t-SNE

## Requirement Description

The article uses t-SNE and I want to draw such a graph using UMAP.

The t-SNE can be found in FigureYa27t-SNE

![](https://ars.els-cdn.com/content/image/1-s2.0-S1534580719301455-fx1.jpg)

出自<https://www.sciencedirect.com/science/article/pii/S1534580719301455?via%3Dihub>

from<https://www.sciencedirect.com/science/article/pii/S1534580719301455?via%3Dihub>

## 应用场景

UMAP，三大主流的降纬方法之一。UMAP相对于t-SNE的优势在于能够保存局部结构信息，也就是空间距离比较近的细胞类群在结果展示的时候也会比较近。这里用到的Seurat的`RunUMAP`其实是调用Python的UMAP进行处理。

## Application Scenarios

UMAP, one of the three mainstream latitude reduction methods. the advantage of UMAP over t-SNE is that it can preserve local structural information, that is, spatially closer cell taxa will be closer in the result display. The `RunUMAP` of Seurat used here actually calls Python's UMAP for processing.

## 环境设置

先查看install_UMAP.md，安装anaconda和UMAP和添加环境变量。

> Windows系统根据提供的视频“Windows10-UMAP安装.mov”进行软件安装和检查

Mac系统这样添加环境变量：

## Environment Setup

First check install_UMAP.md to install anaconda and UMAP and add environment variables.

> Windows systems install and check the software according to the provided video “Windows10-UMAP installation.mov”

Mac systems add environment variables like this:

```r
Sys.getenv("PATH") #检查/Anaconda/bin 是否在环境中
Sys.getenv("PATH"="/anaconda3/bin/") #如果不在的话，需要将其加入环境变量中
Sys.getenv("PATH") #再次检查
```


```r

install.packages("Seurat")
```

加载包

library pacakges
```{r}
source("install_dependencies.R")
# 加载Seurat包 - 用于单细胞RNA测序数据分析
# Load the Seurat package - for single-cell RNA sequencing data analysis
library(Seurat)

# 加载dplyr包 - 提供数据处理和操作的函数
# Load the dplyr package - provides functions for data manipulation and processing
library(dplyr)

# 加载data.table包 - 用于高效处理大型数据集
# Load the data.table package - for efficient handling of large datasets
library(data.table)

# 加载cowplot包 - 用于创建复杂的图形组合
# Load the cowplot package - for creating complex figure compositions
library(cowplot)

# 设置环境变量使R显示英文错误信息（便于搜索解决方案）
# Set environment variable to display English error messages (facilitates searching for solutions)
Sys.setenv(LANGUAGE = "en")

# 禁用字符串自动转换为因子的功能（避免意外的数据类型转换）
# Disable automatic conversion of strings to factors (prevents unexpected data type conversions)
options(stringsAsFactors = FALSE)
```

## 数据读取

Seurat可以直接读取以下两种类型：

1. CellRanger分析结果
2. 表达量矩阵

后文将以表达量矩阵作为输入为例。

## Data reading

Seurat can directly read the following two types:

1. CellRanger analysis results
2. Expression matrices

In the following, we will use the expression matrix as an example of input.

### 读入表达量矩阵CSV/TXT文件

如果是表达量矩阵，是用`data.table::fread()`进行读取。本次的案例数据提供的就是csv文件.

### Reading an expression matrix CSV/TXT file

In case of expression matrix, it is read with `data.table::fread()`. The data provided for this case is the csv file .
