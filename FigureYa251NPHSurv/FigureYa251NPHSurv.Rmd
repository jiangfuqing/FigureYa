---
title: "FigureYa251NPHSurv"
author: "Xiaofan Lu"
reviewers: "Ying Ge,Hui Huang"
date: "2025-5-20"
output: html_document
---
# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述

看起来大鱼老师用了两种非比例风险的预后模型来计算接受了免疫治疗的队列的生存差异，包括RMS限制性生存均值以及long-term survival分析。这个在临床中很有意义，因为免疫治疗患者确实存在老师说的“delayed effect”延迟效应。

# Requirement Description

It appears that the teacher used two non-proportional risk prognostic models to calculate the difference in survival in the cohort that received immunotherapy, including RMS-limiting mean survival and long-term survival analysis. This is very meaningful in clinical practice, because immunotherapy patients do have the "delayed effect" that the teacher said.

![](example.jpg)

出自<https://www.biorxiv.org/content/10.1101/2021.05.30.446369v1.full>的补充材料Supplementary Figure S4a
from<https://www.biorxiv.org/content/10.1101/2021.05.30.446369v1.full> Supplementary Figure S4a

# 应用场景

采用非比例风险的生存模型（non-proportional-hazard survival model, NPHSurv）评价接受免疫治疗患者的预后情况

# Application Scenarios

The non-proportional-hazard survival model (NPHSurv) was used to evaluate the prognosis of patients receiving immunotherapy

original text：**To evaluate the treatment effect of immune checkpoint inhibitors on different iCSs in the IMvigor210 cohort**, we compared the RMS time difference at six months and one year after treatment. We found that the iBS4 subtype showed a significantly poorer outcome than immune-hot iCSs (i.e., iBS1 and iLS2; both P < 0.05 at 6 months, both P < 0.1 at 12 months) and had a segregated survival curve compared to the immune-cold iLS3 subtype (Supplementary Figure S4a). Due to the ***delayed clinical effect of immunotherapy**, we also compared the long-term survival rates after three months of treatment. Consistently, the iBS4 subtype was associated with significantly poorer long-term survival than the immune-hot iBS1 (P = 0.046) and iLS2 (P = 0.027) subtypes and the immune-cold iLS3 subtype (P = 0.095), suggesting its high malignancy and potential resistance to immune checkpoint blockade (Supplementary Figure S4b).

例文中很多图我们都众筹过，例如：

- Figure 1b的画法可参考FigureYa196PanPie
- Figure 2a的算法可参考FigureYa249Regulon，b的画法可参考FigureYa248MutLandscape
- Figure 3de可产考FigureYa25sankey和FigureYa125Fishertest
- Figure 4f可参考FigureYa106immunotherapy，4h可参考<https://k.koudai.com/Eig1YOB4>
- Figure 5b可参考FigureYa12box，f可参考FigureYa162boxViolin
- Figure 6可参考FigureYa35batch_bestSeparation，FigureYa144DiagHeatmap或<https://mp.weixin.qq.com/s/34WRZRBVPHUNRLlzNH2nzw>

We have crowdfunded many of the images in the examples, such as:

- For more information about Figure 1b, see FigureYa196PanPie
- For Figure 2a, see FigureYa249Regulon, and for b, see FigureYa248MutLandscape
- For Figure 3de, see FigureYa25sankey and FigureYa125Fishertest
- Figure 4f can refer to Figure Ya106 immunotherapy, and 4h can refer to <https://k.koudai.com/Eig1YOB4>
- Figure 5b can refer to FigureYa12box, and f can refer to FigureYa162boxViolin
- For Figure 6, see FigureYa35batch_bestSeparation, FigureYa144DiagHeatmap, or <https://mp.weixin.qq.com/s/34WRZRBVPHUNRLlzNH2nzw>

# 环境设置


# Environment settings


```{r}
source("install_dependencies.R")
```

```{r eval=FALSE}

BiocManager::install("survRM2")
BiocManager::install("ComparisonSurv")
install.packages(c("ComparisonSurv", "ggpubr", "survminer", "survRM2"))
```

加载包
load packages

```{r}
library(survRM2)
library(ComparisonSurv)
library(ggplot2)
library(ggpubr)
library(survminer)

Sys.setenv(LANGUAGE = "en") #显示英文报错信息 # error messages are displayed in English
options(stringsAsFactors = FALSE) #禁止chr转成factor # chr is not allowed to be converted to factor
```

# 输入文件

easy_input_annCol.txt，亚型信息。

easy_input_surv.txt，预后信息。

# Input the file

easy_input_annCol.txt, subtype information.

easy_input_surv.txt. Prognostic information.
