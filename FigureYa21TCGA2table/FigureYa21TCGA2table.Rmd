---
title: "FigureYa21TCGA2table"
author: "Guangchuang Yu; Ying Ge, Yijing Chen"
date: "2025-5-20"
output: html_document
---

[<img src="https://guangchuangyu.github.io/blog_images/biobabble.jpg" width="100px"/>](https://guangchuangyu.github.io/blog_images/biobabble.jpg)

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 需求描述
## Requirement description

TCGA临床数据直接用R代码画出三线表。

Draw a three-line table directly using R code for TCGA clinical data.

![](example.png)

## 使用场景
## Usage scenario
输入数据是临床样品信息，例如TCGA提供的clinical information。

根据年龄、性别、种族、病毒感染、吸烟史等特征进行分类对比，可能发现疾病、癌症发病、转移、耐药跟这些特征的关系，例如发现亚洲非吸烟女性肺癌发病率高。

如果还想加入某个基因的表达数据，计算单因素和多因素cox回归的HR，可参考FigureYa47HRtable，还能生成html、word、csv格式的表格。

The input data is information on clinical samples, such as the clinical information provided by TCGA.

Categorical comparisons based on characteristics such as age, gender, ethnicity, viral infection, smoking history, etc., may reveal the relationship between disease, cancer incidence, metastasis, and drug resistance and these characteristics, for example, a high incidence of lung cancer was found in Asian non-smoking women.

If you also want to add the expression data of a certain gene, and calculate the HR of one-way and multi-factor cox regression, you can refer to FigureYa47HRtable, which can also generate tables in html, word and csv formats.

## 环境设置
## Environment setting


```r

BiocManager::install("TCGAbiolinks")
install.packages("kableExtra")
```

加载包

load package

```{r}
source("install_dependencies.R")
library(TCGAbiolinks)
library(dplyr)
library(kableExtra)
```

你可能还需要安装pdflatex

You may also need to install pdflatex

## 输入文件的准备
## Preparation of input files

下载TCGA临床数据。

如果你不需要TCGA数据，而是自己收集的数据，可以整理成像`easy_input.csv`那样的格式，跳过这步，直接进入下一步：“按列分成4组”。

Download the TCGA clinical data.

If you don't need the TCGA data, but have collected it yourself, you can organize it in a format like `easy_input.csv`, skip this step, and go directly to the next step: "Split into 4 groups by columns".

```r
#参数`project = `后面写你要看的癌症名称缩写
#parameter `project = ` followed by the abbreviated name of the cancer you want to see
clinical <- GDCquery(project = "TCGA-LIHC",
                  data.category = "Clinical",
                  file.type = "xml")
GDCdownload(clinical)
cliquery <- GDCprepare_clinic(clinical, clinical.info = "patient")
colnames(cliquery)[1] <- "Tumor_Sample_Barcode"
write.csv(cliquery,"easy_input.csv")
```

## 按列分成4组
## Split into 4 groups by columns

即`Alive`、`Dead with tumor`、`Dead tumor free`、`Total`。

That is, `Alive`, `Dead with tumor`, `Dead tumor free`, `Total`.

```{r,message=FALSE}
x <- read.csv("easy_input.csv")

#%>%，是管道操作符，将上一个函数的输出作为下一个函数的输入
#其实用for循环一个一个嵌套也能实现，就是写起来太烦
#用dplyr包的管道操作符，无论读写都变得清晰容易了
#%>% is a pipeline operator that takes the output of the previous function and uses it as input for the next function.
#In fact, it can be realized by nesting one by one in a for loop, but it's too annoying to write.
#Using the pipeline operator of the dplyr package, both reading and writing become clear and easy

#挑出生存状态是“Alive”的行
#select rows with a survival status of "Alive"
x1 <- x %>% filter(vital_status == "Alive")
#挑出生存状态是“Dead”并且有tumor的行
#select rows with a survival status of "Dead" and a presence of a tumor
x2 <- x %>% filter(vital_status == "Dead" & person_neoplasm_cancer_status == "WITH TUMOR")
x3 <- x %>% filter(vital_status == "Dead" & person_neoplasm_cancer_status == "TUMOR FREE")

#把没信息的行去掉，用于算总数
#remove lines without information to calculate the total
xx = x %>% filter(vital_status != "" & person_neoplasm_cancer_status != "")
```

## 按项细分
## Breakdown by item
### 性别
### Gender
