---
title: "FigureYa80GOclustering"
author: "Ying Ge, Taojun Ye"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# 设置knitr代码块的全局选项 / Set global options for knitr code chunks
```

## 需求描述

富集分析得到太多GO term，其中好多还是相似的，怎样合理的合并？clusterProfiler有一个simplify函数，能给富集分析结果瘦身by removing redundancy of enriched GO terms，但有时瘦的不够多。小丫找到这样一篇例文，它列出了富集的 term，同时在旁边给出一个短语来概括性的描述这几个相似的term：

## Requirement description

Enrichment analysis yields too many GO terms, many of which are still similar. How to merge them reasonably? ClusterProfiler has a simplify function that can thin down enriched GO terms by removing redundancy of enriched GO terms, but sometimes not enough weight is lost. Xiaoya found an example article that lists enriched terms and provides a phrase next to them to summarize these similar terms:

![](example.png)

出自<https://www.nature.com/articles/nature22973>

from<https://www.nature.com/articles/nature22973>

**方法探讨：**

**Method exploration:**

Extended Data Figure 5 | Candidate driver genes and pathways in MB subgroups. c, GO and pathway summary of recurrently mutated genes in MB. GO and pathway categories are **grouped according to functional theme** and the proportion of cases affected by individual pathway alterations are plotted per subgroup and across the series.

例文中关于这些相似term如何合并的描述只说grouped according to functional theme。因此，我用Y叔的GOSemSim计算GO term之间的相似性，然后借助ggtree实现例文中相似GO germ的标注效果。关于ggtree和GOSemSim的问题，请前往Y叔知识星球biobabble讨论。

The description in the example text about how these similar terms are merged only states that they are grouped according to the functional theme. Therefore, I used Y's GOSemSim to calculate the similarity between GO terms, and then used ggtree to achieve the annotation effect of similar GO terms in the example text. Regarding the issues of ggtree and GOSemSim, please go to Y Uncle's knowledge planet biobabble for discussion.

![](method.png)

## 应用场景

多组GO富集分析结果放在一起对比；

富集分析得到太多相似的GO term，需要合并相似的，再结合背景知识概括出合适的pathway。

## Application scenarios

Compare multiple sets of GO enrichment analysis results together;

Enrichment analysis yields too many similar GO terms, which need to be merged and combined with background knowledge to summarize appropriate pathways.

## 环境设置


## Environment settings


```r

if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("GOSemSim", version = "3.8")
BiocManager::install("ggtree", version = "3.8")
```

加载包

library packages

```{r}
source("install_dependencies.R")
# 中文注释：加载plyr包，用于数据处理和操作
# English Comment: Load the plyr package for data manipulation and processing
library(plyr)

# 中文注释：加载stringr包，用于字符串处理和操作
# English Comment: Load the stringr package for string manipulation and processing
library(stringr)

# 中文注释：加载ape包，用于系统发生学和进化分析
# English Comment: Load the ape package for phylogenetic and evolutionary analysis
library(ape)

# 中文注释：加载GOSemSim包，用于基因本体语义相似性分析
# English Comment: Load the GOSemSim package for Gene Ontology semantic similarity analysis
library(GOSemSim)

# 中文注释：加载ggplot2包，用于创建精美的统计图形
# English Comment: Load the ggplot2 package for creating elegant statistical graphics
library(ggplot2)

# 中文注释：加载ggtree包，用于可视化系统发生树
# English Comment: Load the ggtree package for phylogenetic tree visualization
library(ggtree)

# 中文注释：加载scales包，用于图形的坐标轴和图例缩放
# English Comment: Load the scales package for axis and legend scaling in graphics
library(scales)

# 中文注释：加载cowplot包，用于组合和排列多个ggplot图形
# English Comment: Load the cowplot package for combining and arranging multiple ggplot figures
library(cowplot)

# 中文注释：设置环境变量使R显示英文报错信息
# English Comment: Set environment variable to display error messages in English
Sys.setenv(LANGUAGE = "en")

# 中文注释：设置选项禁止将字符串自动转换为因子类型
# English Comment: Set option to prevent automatic conversion of strings to factors
options(stringsAsFactors = FALSE)
```

## 输入文件

富集分析结果至少包含GO term ID（格式为GO:0046777）和一列统计量（例如pvalue、p.ajdust、FDR等等）。

此处用clusterProfier的enrichGO函数做的富集分析结果为例(FigureYa52GOplot的输出文件enrichGO_output.csv)，其中有一列BgRatio，斜线左侧是全基因组范围内该term里基因的数量。例文以300为阈值，去掉了基因数量超过300的term。如果你的数据没有这一列，也可以不做这一步筛选。

## Input file

The enrichment analysis results should include at least GO term ID (in the format GO: 0046777) and a list of statistical measures (such as p-value, p-ajdust, FDR, etc.).

Taking the enrichGO function of clusterProfier as an example (the output file enrichGO_output. csv of FigureYa52GOplot), there is a column called BgRatio, and the left side of the diagonal line represents the number of genes in this term across the entire genome. The example uses 300 as the threshold and removes terms with a gene count exceeding 300. If your data does not have this column, you can also skip this filtering step.
