---
title: "FigureYa101PCA"
author: "Xiaofan Lu, Taojun Ye"
reviewer: "Ying Ge"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# 设置knitr代码块的全局选项 / Set global options for knitr code chunks
```

## 需求描述

RNA-seq的PCA图，同一组用相同颜色，多次重复（批次）用不同形状。我的分组很多，3次重复，不需要像FigureYa38PCA那样画圈画箭头。

## Requirement description

PCA plot of RNA seq, with the same color for the same group and different shapes for multiple repetitions (batches). I have many groups and repeat them three times, so I don't need to draw circles or arrows like in FigureYa38PCA.

![](example.png)

出自<http://genesdev.cshlp.org/content/32/2/96>

from<http://genesdev.cshlp.org/content/32/2/96>

## 应用场景

场景一：每个分组内的样品较多，是不同批次获得的。如果能用各种形状来区分批次的话，就能一眼看出哪个批次远离其他批次，有助于判断批次效应的影响。

场景二：每个分组内的样品是2到n次生物学重复获得的。如果能用各种形状来区分不同重复的话，就能一眼看出哪次重复远离其他重复，有助于判断去掉哪个离群样品。

如果想画圈和箭头，或者无法提供重复或批次batch的信息，请使用FigureYa38PCA。

不仅限于RNA-seq，同样适用于其他类型的数据。

## Application scenarios

Scenario 1: Each group has a large number of samples obtained from different batches. If various shapes can be used to distinguish batches, it can be seen at a glance which batch is far away from other batches, which helps to determine the impact of batch effects.

Scenario 2: The samples within each group are obtained from 2 to n biological replicates. If various shapes can be used to distinguish different repetitions, it can be seen at a glance which repetition is far away from other repetitions, which helps to determine which outlier sample to remove.

If you want to draw circles and arrows, or cannot provide information on duplicates or batches, please use FigureYa38PCA.

Not limited to RNA seq, it also applies to other types of data.

## 环境设置

## Environment settings

```{r}
source("install_dependencies.R")
# 加载stringr包，提供强大的字符串处理功能
# Load the stringr package, which provides powerful string processing functions
library(stringr)

# 设置系统环境，使R显示英文错误信息
# Set the system environment to display English error messages
Sys.setenv(LANGUAGE = "en")

# 全局选项设置：禁止将字符型变量自动转换为因子类型
# Global option setting: Prevent automatic conversion of character variables to factors
options(stringsAsFactors = FALSE)
```

## 自定义函数

包括PCA分析过程以及出图，参数设置：

- indata 是一个矩阵，列为样本，行为观测
- batch 是一个数据框，必须提供批次的信息，否则请使用FigureYa38PCA
- batchvar 是批次的变量名，这里默认batch的列名
- position 是最后出图时图例的位置，从以下位置中选择："bottomright", "bottom", "bottomleft", "left", "topleft", "top", "topright", "right" and "center".
- pch.original 是用于映射replicate形状的，默认从pch=16实心原点开始，到pch=25，一共10种实心图案可供映射，也可以自己选择pch形状起始点，参考：http://www.sthda.com/english/wiki/r-plot-pch-symbols-the-different-point-shapes-available-in-r
- withoutgrid 是一个逻辑变量，指示是否要绘制背景网格（例文的图有网格，个人不推荐）
- 如果想输出样本ID，可以将showID设为TRUE，但样本量大的时候不推荐，图会看不清楚
- 其他参数可保持默认
- 函数细节可根据需要自己修改，比如batch的形状（pch参数）

## Custom functions

Including PCA analysis process and plotting, parameter settings:

-Indata is a matrix with columns as samples and behavioral observations
-Batch is a data box, and batch information must be provided. Otherwise, please use FigureYa38PCA
-Batchvar is the variable name of the batch, which defaults to the column name of the batch
-Position is the position of the legend when the final image is generated. Choose from the following positions: "bottomright", "bottom", "bottomleft", "left", "topleft", "top", "topright", "right", and "center"
-PCH. Original is used to map replica shapes. By default, it starts from the solid origin at PCH=16 and ends at PCH=25. There are a total of 10 solid patterns available for mapping, or you can choose your own starting point for the PCH shape. Please refer to: http://www.sthda.com/english/wiki/r-plot-pch-symbols-the-different-point-shapes-available-in-r
-Withoutgrid is a logical variable that indicates whether to draw a background grid (the example image has a grid, which I personally do not recommend)
-If you want to output the sample ID, you can set showID to TRUE, but it is not recommended when the sample size is large, as the image may not be clear
-Other parameters can remain default
-The details of the function can be modified as needed, such as the shape of the batch (pch parameter)
