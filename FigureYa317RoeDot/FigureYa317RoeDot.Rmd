---
title: "FigureYa317RoeDot"
params:
  author: "Xiaofan Lu; Yasi Zhang"
  reviewer: "Ying Ge"
  date: "2025-05-20"
output: html_document
---

**Author(s)**: `r params$author`
**Reviewer(s)**: `r params$reviewer`
**Date**: `r params$date`

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述
# Requirements Description

基于Ro/e分析对这些细胞亚群进行了组织富集分析，结果观察到肥大细胞和髓系细胞优先分布在动脉粥样硬化核心(AC)部位，而淋巴细胞优先分布在邻近部位。

Tissue enrichment analysis based on Ro/e revealed that mast cells and myeloid cells were predominantly localized in the atherosclerotic core (AC), while lymphocytes were enriched in adjacent regions.

![](example.png)

出自：<https://bmcbiol.biomedcentral.com/articles/10.1186/s12915-023-01540-2>

图1 利用单细胞RNA测序解析动脉粥样硬化的免疫景观
e 通过Ro/e评分估算各细胞类型组织分布情况的折线图

Source: <https://bmcbiol.biomedcentral.com/articles/10.1186/s12915-023-01540-2>

Fig. 1 Dissection of the immune landscape in atherosclerosis with scRNA-seq.
e Line chart showing tissue prevalence for each cell type estimated by Ro/e score

# 应用场景
# Application Scenario

根据单细胞数据，计算细胞比例分布特异度（Ro/e），并绘制折线图

输入：Seurat对象，具有样本来源（Group）和细胞类型（Celltypes）信息

输出：折线图（Proportion.pdf）和Ro/e表格

把多组Ro/e绘制成热图，可参考FigureYa312CellPreference<https://k.youshop10.com/2Pg4u-pL>。

Calculate cell proportion distribution specificity (Ro/e) based on single-cell data and plot a line graph

Input: Seurat object containing sample origin (Group) and cell type (Celltypes) information

Output: Line graph (Proportion.pdf) and Ro/e table

Plot the Ro/e values of multiple groups as a heatmap, refer to FigureYa312CellPreference<https://k.youshop10.com/2Pg4u-pL> for guidance.

# 环境设置
# Environment Setup


```{r}
source("install_dependencies.R")

```

# 加载包
# Loading packages

```{r}
library(Seurat)

# 用于从GEO里的GSE159677_series_matrix.txt.gz文件读取样本信息
# For reading sample information from GSE159677_series_matrix.txt.gz in GEO
library(GEOquery)

library(magrittr)
library(plyr)
library(openxlsx)
library(GSVA)

# 用于生成期望频数表(Ro/e计算)
# For generating expected frequency tables (Ro/e calculation)
library(epitools)

library(reshape2)
library(ggplot2)

# 显示英文报错信息
# Show English error messages
Sys.setenv(LANGUAGE = "en")

# 禁止chr转成factor
# Prevent character-to-factor conversion
options(stringsAsFactors = FALSE)
```

# 输入文件
# Input Files

从GEO下载输入数据，<https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE159677>。下载Supplementary file表格里的`GSE159677_RAW.tar`，和Download family里的`Series Matrix File(s)`，存放在InputData文件夹里。

Download input data from GEO: <https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE159677>.
Download `GSE159677_RAW.tar` from the Supplementary files table and `Series Matrix File(s)` from the Download family section, then store them in the InputData folder.

![](InputData.png)

单细胞数据的准备

Preparation of Single-Cell Data
