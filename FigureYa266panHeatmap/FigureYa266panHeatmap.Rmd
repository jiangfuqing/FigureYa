---
title: "FigureYa266panHeatmap"
params:
  author: "Xiaofan Lu; Yasi Zhang"
  reviewer: "Ying Ge"
  date: "2025-05-20"
output: html_document
---

**Author(s)**: `r params$author`
**Reviewer(s)**: `r params$reviewer`
**Date**: `r params$date`

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述
# Demand description

复现Figure1的EF，希望能用原始数据。

Replicate Figure 1E-F using raw data where possible.

![](example.png)

出自：<https://molecular-cancer.biomedcentral.com/articles/10.1186/s12943-019-1066-3>

图1 m6A调控因子的泛癌遗传学及表达改变
e 17种癌症类型中m6A调控因子的基因表达改变。热图显示倍数变化，红色代表上调基因，蓝色代表下调基因。
f 箱线图展示IGF2BP3在15种癌症类型的肿瘤和正常样本中的表达分布。

Source: <https://molecular-cancer.biomedcentral.com/articles/10.1186/s12943-019-1066-3>

Fig. 1 Pan-cancer genetic and expression alterations of m6A regulators.
e The gene expression alterations of m6A regulators in 17 cancer types. The heat map shows the fold changes, with red representing up-regulated genes, and blue representing down-regulated genes.
f Box plots showing the expression distribution of IGF2BP3 across tumor and normal samples in 15 cancer types.

# 应用场景
# Application scenarios

对泛癌中肿瘤与正常样本做多个基因（m6A为例）的差异表达分析，并根据log2FoldChange值绘制泛癌热图，同时对感兴趣基因绘制泛癌箱型图。

如果想换成泡泡图结合柱形图，可参考FigureYa263panDiff，<https://k.youshop10.com/v5okDUEr>

如果想用GSEA计算并展示多个**基因集**的差异表达，可参考FigureYa253panGSEA，<https://k.youshop10.com/QbM6nwGB>

如果只对单个基因感兴趣，可参考FigureYa55panCancer_violin，画成小提琴图或box plot，<https://www.yuque.com/figureya/figureyaplus/figureya55p>。

另外，我们还众筹过这篇文章的其他几个有意思的图：

- Fig.1D对角热图，可参考FigureYa144DiagHeatmap或<https://mp.weixin.qq.com/s/34WRZRBVPHUNRLlzNH2nzw>
- Fig.2A靶向关系连线图，可参考FigureYa199crosslink，<https://k.youshop10.com/Zbb7VoNM>，带你实现连线自由
- Fig.3A基因集的survival landscape，可参考FigureYa210survivalScape，<https://k.youshop10.com/dDv=wvoj>

更多泛癌FigureYa看这里，<https://k.youshop10.com/C8RkTgR3>

Perform differential expression analysis of multiple genes (using m6A as an example) between tumor and normal samples across pan-cancer datasets, and generate pan-cancer heatmaps based on log2FoldChange values, along with pan-cancer box plots for genes of interest.

To switch to bubble charts combined with bar plots, refer to FigureYa263panDiff <https://k.youshop10.com/v5okDUEr>

To use GSEA for calculating and displaying differential expression of **multiple gene sets**, refer to FigureYa253panGSEA <https://k.youshop10.com/QbM6nwGB>

If only interested in a single gene, refer to FigureYa55panCancer_violin to create violin plots or box plots <https://www.yuque.com/figureya/figureyaplus/figureya55p>.

Additionally, we have crowdsourced several other interesting figures from this article:

- Fig.1D diagonal heatmap, refer to FigureYa144DiagHeatmap or <https://mp.weixin.qq.com/s/34WRZRBVPHUNRLlzNH2nzw>
- Fig.2A target relationship connection diagram, refer to FigureYa199crosslink<https://k.youshop10.com/dDv=wvoj>, achieving connection freedom
- Fig.3A survival landscape of gene sets, refer to FigureYa210survivalScape<https://k.youshop10.com/dDv=wvoj>

For more pan-cancer FigureYa resources, see here<https://k.youshop10.com/C8RkTgR3>

# 环境设置
# Environment Setup


```{r}
source("install_dependencies.R")

```

# 加载包
# Loading packages

```{r}
library(data.table)
library(impute)
library(ClassDiscovery)
library(ComplexHeatmap)
source("twoclasslimma.R")

# 显示英文报错信息
# Show English error messages
Sys.setenv(LANGUAGE = "en")

# 禁止chr转成factor
# Prevent character-to-factor conversion
options(stringsAsFactors = FALSE)
```

# 输入文件
# Input Files

跟FigureYa253panGSEA、FigureYa263panDiff、FigureYa265panCNV使用的是同一套输入数据，已经下载的小伙伴就不用重复下载了。

merged_sample_quality_annotations.tsv: 下载自<https://gdc.cancer.gov/about-data/publications/pancanatlas>，下载地址<http://api.gdc.cancer.gov/data/1a7d7be8-675d-4e60-a105-19d4121bdebf>

EBPlusPlusAdjustPANCAN_IlluminaHiSeq_RNASeqV2.geneExp.tsv: 表达矩阵，第一列是基因，之后是其在每个样本中的表达量。下载自<http://api.gdc.cancer.gov/data/3586c0da-64d0-4b74-a449-5ff4d9136611>

These files use the same input data as FigureYa253panGSEA, FigureYa263panDiff, and FigureYa265panCNV - if you've already downloaded them, no need to download again.

merged_sample_quality_annotations.tsv: Downloaded from<https://gdc.cancer.gov/about-data/publications/pancanatlas>. Direct download link: <http://api.gdc.cancer.gov/data/1a7d7be8-675d-4e60-a105-19d4121bdebf>.

EBPlusPlusAdjustPANCAN_IlluminaHiSeq_RNASeqV2.geneExp.tsv:
Expression matrix where the first column contains gene names, followed by expression values for each sample. Downloaded from<http://api.gdc.cancer.gov/data/3586c0da-64d0-4b74-a449-5ff4d9136611>
