---
title: "FigureYa293machineLearningV2"
params:
  author: "Guoqi Li; Yasi Zhang"
  reviewer: "Ying Ge"
  date: "2025-05-20"
output: html_document
---

**Author(s)**: `r params$author`
**Reviewer(s)**: `r params$reviewer`
**Date**: `r params$date`

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述
# Demand description

这个文章里比较不同的模型放在一个图，以及比较不同的算法放在一个图。

In this article, different models are compared in one graph, and different algorithms are compared in another graph.

![](example.png)

出自<https://www.nature.com/articles/s41467-022-28421-6>

图2 通过基于机器学习的整合流程，开发并验证了一种共识性IRLS模型。
A 在LOOCV框架下构建了共计101种预测模型，并计算了各模型在所有验证数据集中的C指数。
B 在TCGA-CRC队列（n = 584）中，当偏似然偏差达到最小值时确定最优λ值，并进一步生成最具预后价值基因的Lasso系数。数据以均值±95%置信区间[CI]表示。
C 逐步Cox回归最终获得的16个lncRNA系数。
D–K 基于IRLS的TCGA-CRC患者总生存期（OS）Kaplan-Meier曲线（对数秩检验：P = 9.16e−19）。

Source: <https://www.nature.com/articles/s41467-022-28421-6>

Fig. 2 A consensus IRLS was developed and validated via the machine learning-based integrative procedure.
A A total of 101 kinds of prediction models
via LOOCV framework and further calculated the C-index of each model across all validation datasets.
B In the TCGA-CRC cohort (n = 584), the determination of the optimal λ was obtained when the partial likelihood deviance reached the minimum value, and further generated Lasso coefficients of the most useful prognostic genes. Data are presented as mean ± 95% confidence interval [CI].
C Coefficients of 16 lncRNAs finally obtained in stepwise.
Cox regression. D–K Kaplan–Meier curves of OS according to the IRLS in TCGA-CRC (log-rank test: P = 9.16e−19).

# 应用场景
# Application scenarios

基于这10种算法的组合去构建模型，会受到输入数据集的基因数目和质量的影响。

因此，基于不同的基因，有些模型可能得不到特征而出现报错的现象，这属于正常现象。

最后的result都会有结果，但是得到结果会有变化，以及有些模型（指单一模型）或模型组合（指组合模型）预测效能的C指数为0.5，这些模型都是未得到结果的模型（根本原因是输入数据中基因的问题），所以可以调整输入数据的基因来获取更多有结果的模型组合结果。

例文当中有些Figure的画法可参考我们之前众筹过的FigureYa：

- Figure 1，FigureYa69cancerSubtype、FigureYa71ssGSEA、FigureYa55panCancer_violin、FigureYa15WGCNA、FigureYa170ImmuLncRNA
- Figure 2，FigureYa293machineLearning、FigureYa31lasso、FigureYa35batch_bestSeparation
- Figure 3，FigureYa189timeCindex、FigureYa220repeatedLasso
- Figure 5，FigureYa90subgroup
- Figure 6，FigureYa105GDSC
- Figure 7，FigureYa71ssGSEA、FigureYa152DouleCorPlot

The performance of models built using these 10 algorithms in combination is influenced by the number and quality of genes in the input dataset.

Therefore, depending on the genes used, some models may fail to extract features and return errors—this is a normal occurrence.

All final results will be generated, but the outcomes may vary. Additionally, some models (single models) or model combinations (ensemble models) may yield a C-index of 0.5, indicating that they failed to produce meaningful results (primarily due to issues with the input gene data). To obtain more valid model combinations, adjusting the input gene set may help.

For reference on figure design, you may consult our previously crowdsourced FigureYa:

- Figure 1，FigureYa69cancerSubtype、FigureYa71ssGSEA、FigureYa55panCancer_violin、FigureYa15WGCNA、FigureYa170ImmuLncRNA
- Figure 2，FigureYa293machineLearning、FigureYa31lasso、FigureYa35batch_bestSeparation
- Figure 3，FigureYa189timeCindex、FigureYa220repeatedLasso
- Figure 5，FigureYa90subgroup
- Figure 6，FigureYa105GDSC
- Figure 7，FigureYa71ssGSEA、FigureYa152DouleCorPlotexamples.

# 环境设置
# Environment Setup


```{r}
source("install_dependencies.R")
```

```{r eval=FALSE}

BiocManager::install("mixOmics")
install.packages("plsRcox")
BiocManager::install("survcomp")
install.packages("rlang")
library(devtools)
install_github("binderh/CoxBoost")
```

# 加载包
# Loading packages

```{r}
library(survival)
library(randomForestSRC)
library(glmnet)
library(plsRcox)
library(superpc)
library(gbm)
library(CoxBoost)
library(survivalsvm)
library(dplyr)
library(tibble)
library(BART)
library(miscTools)
library(compareC)
library(ggplot2)
library(ggsci)
library(tidyr)
library(ggbreak)

# 显示英文报错信息
# Show English error messages
Sys.setenv(LANGUAGE = "en")

# 禁止chr转成factor
# Prevent character-to-factor conversion
options(stringsAsFactors = FALSE)
```

# 输入文件
# Input Files

TCGA.txt，GSE57303.txt，GSE62254.txt，数据集。行为样本，第一列为样本名，第二三列为生存时间和生存状态，后面的列均为基因。文件较大，已上传至微云 <https://share.weiyun.com/y3qYgKCK>

TCGA.txt, GSE57303.txt, GSE62254.txt, datasets. Rows represent samples, with the first column being sample names, the second and third columns being survival time and survival status, and the remaining columns all being genes. The files are large and have been uploaded to Weiyun <https://share.weiyun.com/y3qYgKCK>
