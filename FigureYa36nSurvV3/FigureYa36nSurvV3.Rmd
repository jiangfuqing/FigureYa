---
title: "FigureYa36双因子生存分析v3"
author: "Guoshuang Feng; Ying Ge, Yijing Chen"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述
# Requirement description

用R画出paper里的双因子生存分析图，计算p value。

Use R to draw the two-factor survival analysis plot from the paper and calculate the p value.

![](example1.jpg)

出自<https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3282708/>

图 4. 使用DE和HE表达水平组合的总生存率曲线。单变量Cox回归用于确定HR；报告的是对数检验p值；配对比较的Bonferroni多重检验调整 p = 0.05/5 = 0.01。DE：恶性上皮组织中的Decorin 染色。上皮组织中的Decorin染色。HE：恶性上皮组织中的HSP90B1染色。HR：危险比

另外，小伙伴用到这个FigureYa发表了文章，供参考：

from<https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3282708/>

Figure 4. Overall survival curves using combinations of DE and HE expression levels. Univariate Cox regression used to determine HR;
logrank p-values reported; Bonferroni multiple testing adjustment for pairwise comparisons p = 0.05/5 = 0.01. DE: Decorin staining in malignant
epithelial tissue. HE: HSP90B1 staining in malignant epithelial tissue. HR: Hazard ratio

Additionally, a colleague used this FigureYa to publish an article for reference:

![](example2.png){width=300px}")

出自<https://molecular-cancer.biomedcentral.com/articles/10.1186/s12943-020-01170-0>

from<https://molecular-cancer.biomedcentral.com/articles/10.1186/s12943-020-01170-0>

# 应用场景
# Application scenario

对比两个因素对生存的影响。

例如，基因A和B都高表达，跟基因A和B都低表达比起来，生存期是否更长？

Compare the effects of two factors on survival.

For example, does high expression of both genes A and B result in longer survival compared to low expression of both genes A and B?

# 环境设置
# Environment setting


```{r}
source("install_dependencies.R")

```

加载包

load package

```{r}
library(survival)
library(survminer)
Sys.setenv(LANGUAGE = "en") #显示英文报错信息 display English error messages
options(stringsAsFactors = FALSE) #禁止chr转成factor prohibit the conversion of chr to factor
```

# 输入文件
# Input file

至少包含5列：依次是sample名字、Time、Death、第一个基因的表达量（基因名作为列名）、第二个基因的表达量（基因名作为列名）。**顺序不要变**

此处提取FigureYa35batch_bestSeparation的基因AKAP12和MAP2K6作为输入文件，以基因AKAP12和MAP2K6作为双因素。

It contains at least 5 columns: sample name, Time, Death, expression of the first gene (gene name as column name), and expression of the second gene (gene name as column name), in that order. **don't change the order**

Here the genes AKAP12 and MAP2K6 of FigureYa35batch_bestSeparation are extracted as input files, and the genes AKAP12 and MAP2K6 are used as two-factors.

```{r}
df <- read.csv("easy_input.csv",row.names = 1)
head(df)
```

# 基因表达量高低的划分
# Classification of gene expression levels low and high

这里提供两种方法划分基因表达水平的low和high：

- 方法1. 用FigureYa35batch_bestSeparation找出最佳分组，获得划分low和high的分界表达量；基因AKAP12和MAP2K6的low跟high的分界表达量分别是766.37和880.23。

Here are two methods to classify gene expression levels as low and high:

- Method 1. Use FigureYa35batch_bestSeparation to find out the best grouping and get the cut-off expression amount for dividing the low and high; the cut-off expression amounts of low and high for genes AKAP12 and MAP2K6 are 766.37 and 880.23 respectively.

```{r}
df$bestA <- cut(df[,3],breaks=c(-Inf,766.37, Inf), #其中766.37要改成你的基因A的高低分界值 among them, 766.37 should be changed to the high and low boundary value of your gene A
                   labels=c("0","1"))
df$bestB <- cut(df[,4],breaks=c(-Inf,880.23, Inf), #其中880.23要改成你的基因B的高低分界值 among them, 880.23 should be changed to the high and low boundary value of your gene B
                   labels=c("0","1"))
df$bestGroup <- paste0(df$bestA,df$bestB)
#按照两个基因表达量高低的排列组合分成4组
#divided into 4 groups according to the arrangement of high and low expression of the two genes
df$bestGroup <- ifelse(df$bestGroup=='00','1',ifelse(df$bestGroup=='10','2',ifelse(df$bestGroup=="01","3","4")))
head(df)

df$group <- df$bestGroup
```

- 方法2. 用中位数划分表达量的高与低

- Method 2: Classify high and low expression levels by medians

```{r eval=FALSE}
df$medA <- cut(df[,3],breaks=c(-Inf,median(df[,3]), Inf),
                   labels=c("0","1"))
df$medB <- cut(df[,4],breaks=c(-Inf,median(df[,4]), Inf),
                   labels=c("0","1"))
df$medGroup <- paste0(df$medA,df$medB)
#按照两个基因表达量高低的排列组合分成4组
#divided into 4 groups according to the arrangement of high and low expression of the two genes
df$medGroup <- ifelse(df$medGroup=='00','1',ifelse(df$medGroup=='10','2',ifelse(df$medGroup=="01","3","4")))
head(df)

df$group <- df$medGroup
```

# 统计运算
# Statistical operations
