---
title: "FigureYa25Sankey_update"
author: "Ying Ge, Xiaofan Lu; Yijing Chen"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述
# Requirement description

用R代码画出paper里的图。

Use R code to draw the plot in paper.

![](example.png)

出自<https://www.nature.com/articles/nature22973>

from<https://www.nature.com/articles/nature22973>

# 应用场景
# Application scenario

一套数据集可能有多重属性，每层属性之间有交叉，就可以用这种图来展示。另外，以第一变量为参照，往后的多层变量均参考与第一变量的关系，从而展示第一变量的流向。

- 场景一：一个group包含多个基因，同一个基因的不同突变可能属于多个group。像例图一样，展示高频突变基因所处的分组。

原文：Graphical summary of the most frequently mutated genes (≥10 affected cases) and their subgroup distribution.

... many of which showed clear subgroup-specificity (Fig. 2a–c; Extended Data Fig. 3a, b; Supplementary Table 2).

- 场景二：miRNA和靶基因的关系，可参考群里小伙伴的用法：<https://onlinelibrary.wiley.com/doi/full/10.1002/jcp.28522>

- 场景三：人群按性别、年龄、家族史等特征分组，展示不同分组得癌症的规律。

A dataset may have multiple attributes, and when there is an overlap between each layer of attributes, this type of plot can be used to display it. Additionally, using the first variable as a reference, subsequent multi-layer variables are all based on their relationship with the first variable, thereby illustrating the flow of the first variable.

- Scenario 1: A group contains multiple genes, and different mutations of the same gene may belong to multiple groups. Display the groups containing high-frequency mutated genes, as shown in the example image.

Original text: Graphical summary of the most frequently mutated genes (≥10 affected cases) and their subgroup distribution.

... many of which showed clear subgroup-specificity (Fig. 2a–c; Extended Data Fig. 3a, b; Supplementary Table 2).

- Scenario 2: The relationship between miRNAs and target genes, please refer to the usage of the group: <https://onlinelibrary.wiley.com/doi/full/10.1002/jcp.28522>.

- Scenario 3: The population is grouped by gender, age, family history and other characteristics, to show the pattern of cancer in different groups.

# 环境设置
# Environment setting

```{r}
source("install_dependencies.R")


library(ggalluvial)
library(dplyr)

Sys.setenv(LANGUAGE = "en") #显示英文报错信息 display English error messages
options(stringsAsFactors = FALSE) #禁止chr转成factor prohibit the conversion of chr to factor
```

# 输入数据
# Input data

easy_input.txt，至少要有两列，想画出几列就提供几列数据。此处第一列是基因，第二列是突变，第三列是癌症亚型；想画更多层次关系就继续向后添加列。

或者只写两列，第一列是miRNA，第二列是它的靶基因。

easy_input.txt, there should be at least two columns; provide as many columns of data as you want to draw. Here the first column is the gene, the second is the mutation, and the third is the cancer subtype; keep adding columns backwards if you want to draw more hierarchical relationships.

Or just write two columns, with the first column being the miRNA and the second column being its target gene.

```{r}
df <- read.table("easy_input.txt",sep = "\t",row.names = 1,header = T)
head(df)

#定义足够多的颜色，后面从这里选颜色
#define enough colors to pick colors from later
mycol <- rep(c("#223D6C","#D20A13","#FFD121","#088247","#11AA4D","#58CDD9","#7A142C","#5D90BA","#029149","#431A3D","#91612D","#6E568C","#E0367A","#D8D155","#64495D","#7CC767"),2)
```

# 开始画图
# Start drawing

两种方式展示前后关系：

- 后一层继承前一层的关系；
- 后面多层继承第一层的关系。

Two ways to show the before and after relationships:

- The latter layer inherits the relationship of the former layer;
- Multiple layers behind inherit the relationship of the first layer.

## 后一层继承前一层的关系
## The latter layer inherits the relationship of the former layer
