---
title: "FigureYa87fish"
author: "Chengli Song, Taojun Ye"
reviewer: "Ying Ge"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# 设置knitr的全局代码块选项 / Set global chunk options for knitr
```

## 需求描述

用R画文章里的这种肿瘤克隆进化的图。

## Requirement description

Draw a graph of the evolution of tumor clones in the article using R.

![](example.png)

出自<https://www.nature.com/articles/leu2014289>

from<https://www.nature.com/articles/leu2014289>

## 应用场景

## Application scenarios

Create timecourse "fish plots" that show changes in the clonal architecture of tumors, <https://github.com/chrisamiller/fishplot>

展示肿瘤细胞克隆进化的时间、比例等信息。

像例文那样，在三维时间节点上共鉴定到4个克隆群，我们可以看到其中founding clone 在三个时间点上占比都非常高，70%左右，除去这个主克隆外，还有三个亚克隆，在三个时间点上变化比较大，其中主要是subclone 1 的逐渐消失，subclone2 的逐渐扩增以及subclone 3的从无到有。

**题外话：**还有一个R包timescape，画clonal evolution这种鱼图也很美，<https://bioconductor.org/packages/release/bioc/vignettes/timescape/inst/doc/timescape_vignette.html>。

克隆进化图有点像sankey，我拿来FigureYa25sankey对比着看，理解更透彻。

Display information such as the time and proportion of tumor cell clone evolution.

As shown in the example text, a total of four clone groups were identified at three-dimensional time points. We can see that the proportion of founding clones was very high at three time points, about 70%. In addition to the main clone, there were three subclones with significant changes at the three time points, mainly the gradual disappearance of subclone 1, the gradual expansion of subclone 2, and the emergence of subclone 3 from scratch.

**Off topic: * * There is also an R package called timescape, which is also very beautiful for drawing fish images like clonal evolution< https://bioconductor.org/packages/release/bioc/vignettes/timescape/inst/doc/timescape_vignette.html >.

The clone evolution diagram is a bit like a sankey. I compared it with FigureYa25sankey for a more thorough understanding.

## 环境设置


## Environment settings


```r

install.packages("devtools")
library(devtools)
install_github("chrisamiller/fishplot")
```

加载包

```{r}
source("install_dependencies.R")
# 加载fishplot包，用于生成白血病克隆演化的鱼群图
# Load the fishplot package for generating fish plots of leukemia clonal evolution
library(fishplot)

# 设置环境变量使R显示英文错误信息，便于查找解决方案
# Set environment variable to display error messages in English for easier troubleshooting
Sys.setenv(LANGUAGE = "en")

# 全局设置禁止将字符型数据自动转换为因子类型，避免意外的数据转换
# Globally disable automatic conversion of character strings to factors to prevent unexpected data transformation
options(stringsAsFactors = FALSE)
```

## 输入数据

需要三种输入：

- easy_input.txt，每行表示每个克隆群在不同时间节点的VAF/CCF 占比，每列表示每个时间节点中各个克隆簇的情况。

- timepoints，用来定义easy_input.txt的四列对应的4个时间节点。其中therapyTime列是化疗后休复期推断出的克隆群整体状况。

- parents，与时间节点相对应的各个克隆群进化关系。例图中，“0”表示主克隆，“1, 1”表示在主克隆之后有两个平行发展的亚克隆簇，“3”表示在这个克隆簇发生时，已经有两次克隆事件。进一步根据各个时间节点，各个克隆簇占比情况，脚本便可实现。为便于理解parents的写法，结尾附上了几个例子。

## Input data

Three types of inputs are required:

- easy_input.txt， Each row represents the VAF/CCF ratio of each clone group at different time points, and each column represents the situation of each clone cluster at each time point.

- timepoints， Used to define the four time nodes corresponding to the four columns of easy_input.txt. The treatyTime column represents the overall status of the clone population inferred during the recovery period after chemotherapy.

- parents， The evolutionary relationship of each clone group corresponding to the time node. In the example diagram, "0" represents the main clone, "1, 1" represents two parallel sub clone clusters after the main clone, and "3" represents that there have been two cloning events occurring in this clone cluster. Further, based on the proportion of each clone cluster at each time node, the script can be implemented. For the convenience of understanding the writing of 'parents', several examples are attached at the end.
