---
title: "FigureYa312CellPreference"
params:
  author: "Xiaofan Lu; Yasi Zhang"
  reviewer: "Ying Ge"
  date: "2025-05-20"
output: html_document
---

**Author(s)**: `r params$author`
**Reviewer(s)**: `r params$reviewer`
**Date**: `r params$date`

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述
# Demand description

想复现算这个preference的值，复现图Fig3c

We want to reproduce the calculation of preference values and recreate Fig3c.

![](example1.png)

出自：<https://www.nature.com/articles/s41586-022-05400-x>

图3. 人类中性粒细胞的异质性及功能验证
b. 通过**Ro/e值(观察细胞数与期望细胞数的比值)**揭示的人类中性粒细胞簇组织偏好性

Source: <https://www.nature.com/articles/s41586-022-05400-x>

Fig. 3 | Neutrophil heterogeneity and functional validation in humans.
b, Tissue preference of neutrophil clusters in humans, revealed by
**Ro/e (ratio of observed cell number to expected cell number)**.


类似的图：

Similar figure:

![](example2.jpg)

出自：<https://www.cell.com/cell/fulltext/S0092-8674(20)30341-X?_returnURL=https%3A%2F%2Flinkinghub.elsevier.com%2Fretrieve%2Fpii%2FS009286742030341X%3Fshowall%3Dtrue>

图2. 通过单细胞RNA测序技术对人类结直肠癌中肿瘤浸润性髓系细胞的表征
(C) 采用Ro/e评分(103个单细胞RNA测序样本)估算的组织分布情况(STAR方法部分)。

Source: <https://www.cell.com/cell/fulltext/S0092-8674(20)30341-X?_returnURL=https%3A%2F%2Flinkinghub.elsevier.com%2Fretrieve%2Fpii%2FS009286742030341X%3Fshowall%3Dtrue>

Figure 2. Characterization of Tumor-Infiltrating Myeloid Cells by scRNA-seq in Human CRC
(C) Tissue prevalence estimated by Ro/e score (103 scRNA-seq) (STAR Methods).

# 应用场景
# Application scenarios

计算各细胞类型（Celltypes）在各组织（Tissue）的偏好性/富集程度，并绘制热图。

Ro/e (ratio of observed cell number to expected cell number)

偏好性计算方法：实际细胞数目/期望细胞数目，期望细胞数为各组织中各细胞类型均匀分布下的细胞数目

更多单细胞分析画图的FigureYa：<https://k.youshop10.com/McawGY6=>

Calculate the preference/enrichment level of each cell type (Celltypes) across different tissues (Tissue), and visualize the results with a heatmap.

Ro/e (ratio of observed cell number to expected cell number)

Calculation method: Actual cell count / Expected cell count, where the expected cell count represents the uniformly distributed cell number for each cell type across tissues.

For more single-cell analysis visualization tools from FigureYa: <https://k.youshop10.com/McawGY6=>

# 环境设置
# Requirements Description


```{r}
source("install_dependencies.R")
```

```{r eval=FALSE}

install.packages("epitools")
```

# 加载包
# Loading packages

```{r}
library(epitools)
library(ComplexHeatmap)

# 显示英文报错信息
# Show English error messages
Sys.setenv(LANGUAGE = "en")

# 禁止chr转成factor
# Prevent character-to-factor conversion
options(stringsAsFactors = FALSE)
```

# 输入文件
# Input Files

neu-CountBySample.csv和neu-CountByTissue.csv，频数统计表，为例文作者提供的注释数据。每一行为各细胞类型，每一列为各组织。

对于自己的单细胞测序数据，这样得到observe.data：

```{r eval=FALSE}
as.matrix(as.data.frame.matrix(table(seu.obj$Tissue, seu.obj$Celltypes)))
```
