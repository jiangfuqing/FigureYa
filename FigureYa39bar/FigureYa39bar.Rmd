---
title: "FigureYa39bar"
author: "Ying Ge; Yijing Chen"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 需求描述
## Requirement description

图一：不同的癌症用不同的颜色展示

Figure 1: Different cancers shown in different colors

![](example1.png)

出自<https://www.nejm.org/doi/full/10.1056/NEJMoa1714448>

from<https://www.nejm.org/doi/full/10.1056/NEJMoa1714448>

图二：做类似的图用于GO、KEGG富集分析结果展示，不显著的显示灰色，左右分开的名称，正负富集分开，左右分开画在一张图上。

Figure 2: Do similar diagrams for GO, KEGG enrichment analysis results show. Display non-significant results in gray, separate names on the left and right, with positive and negative enrichment separated, left and right separate drawn on a graph.

![](example2.jpeg)

出自<https://www.nature.com/articles/s41591-018-0096-5>

原文的输入数据是GSVA score，本代码只模仿形式，不包括GSVA分析。

from<https://www.nature.com/articles/s41591-018-0096-5>

The input data for the original article is the GSVA score; this code only mimics the form and does not include GSVA analysis.

## 应用场景
## Application scenario

场景一：各肿瘤某一指标的比较，例如图一的肿瘤缓解率。

场景二：GSVA结果展示，类似于图二。

Scenario 1: Comparison of a certain index across tumors, such as tumor remission rate in Figure 1.

Scenario 2: GSVA results are presented, similar to Figure 2.

### 场景一
### Scenario 1

每个ID显示为一种颜色

Each ID is shown as a color

### 输入数据
### Input data

```{r}
source("install_dependencies.R")
df<-read.csv("easy_input1.csv")
head(df)

#按照score排序
#sort by score
df<-df[order(df$score,decreasing = T),]
df$index<-seq(1,nrow(df))
head(df)
```

### 开始画图
### Start drawing

```{r,fig.width=7,fig.height=5}
library(ggplot2)
p<-ggplot(df,aes(x=index,y=score,fill=ID)) +
  geom_bar(stat = 'identity',width = 0.8) +
  scale_fill_brewer(type = "Qualitative", palette = "Paired") + #bar的颜色 color of bar

  scale_y_continuous(breaks=seq(-100, 100, 10), #y轴刻度 y-axis scale
                     expand = c(0,0)) + #上下都不留空 there's no space between the top and the bottom
  scale_x_discrete(expand = expand_scale(mult = c(0.01,0))) + #左边留空，右边到头 leave the left side blank, the right side goes to the end

  #画3条横线
  #draw 3 horizontal lines
  geom_hline(yintercept = c(-30,0,20),
             linetype = 5, #画虚线 draw a dotted line
             size = 0.3) + #线的粗细 thickness of line

  #其他主题
  #other themes
  labs(x = "", y = "Maximum Change in Tumor Size (%)",
       title = "A Maximum Change in Tumor Size, According to Tumor Type") +
  theme_bw() + #去除背景色 remove background color
  theme(panel.grid =element_blank()) + #去除网格线 remove gridlines
  theme(panel.border = element_blank()) + #去除外层边框 remove outer border
  theme(axis.line = element_line(colour = "black")) + #沿坐标轴显示直线 display lines along the axes
  theme(axis.line.x = element_blank(), axis.ticks.x = element_blank(), axis.text.x = element_blank()) + #去除x轴 remove x-axis

  #图例
  #legend
  guides(fill = guide_legend(ncol = 5,title = NULL)) + #图例分5列 legend divided into 5 columns
  scale_size(range=c(5,20)) +
  theme(legend.background = element_blank(), #移除整体边框 remove overall border
        #图例的左下角置于绘图区域的左下角
        #the lower left corner of the legend is placed in the lower left corner of the drawing area
        legend.position=c(0,0),legend.justification = c(0,0))
        #改用下面这行，图例就会位于顶部 change to the following line and the legend will be at the top
        #legend.position="top")
p
#保存到PDF文件
#save to PDF file
ggsave("CancerBar.pdf",width = 8,height = 5)
```

### 极大值的处理
### Handling of maximum value

有一个值远高于其他值，右侧会很空。

因此，原图作者让y轴适合大部分数据，然后在最高的那个bar上标出实际数据

Having one value much higher than the others would be very empty on the right side.

So the author of the original graph made the y-axis fit most of the data, and then labeled the highest one bar with the actual data
