---
title: "FigureYa250ImmGenePair"
author: "Xiaofan Lu"
reviewers: "Ying Ge,Hui Huang"
date: "2025-5-20"
output: html_document
---
# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述

希望复现第一段构建的算法。只要第一段的计算就行，后面lasso的FigureYa也都有。

# Requirement Description

I want to reproduce the algorithm built in the first segment. As long as the calculation of the first paragraph is OK, the FigureYa of lasso also has it.

![](method.png)

Construction of an Individualized Prognostic Signature Based on IRGPs

We constructed a prognostic signature by focusing on immune-related genes (IRGs), which were downloaded from the ImmPort database (https://immport.niaid.nih.gov). A variety of IRGs were included, such as cytokines, cytokine receptors, and genes related to the T-cell receptor signaling pathway, B-cell antigen receptor signaling pathway, natural killer cell cytotoxicity, and antigen processing and presentation pathways. Immune-related genes measured by all platforms were selected. The gene expression level in a specific sample or profile underwent pairwise comparison to generate a score for each IRGP. **An IRGP score of 1 was assigned if IRG 1 was less than IRG 2; otherwise the IRGP score was 0**.

This **gene pair–based approach has an important advantage because the score is calculated based entirely on the gene expression profile of a tumor sample and can be used in an individualized manner without the need for normalization**. Some IRGPs with constant values (0 or 1) in a particular platform or data set may be attributable to
(1) platform-dependent preferential measurement, which can cause biases and may not be reproducible across platforms, and
(2) biologically preferential transcription, which does not provide discriminative information about patient survivial. Therefore, we removed IRGPs with constant values in any individual data set of the meta-data set.

Prognostic IRGPs were selected using the log-rank test to assess the association between each IRGP and patients’ overall survival in the meta-training data set. **Prognostic IRGPs with a familywise error rate less than 0.05 were candidates to build the IRGP index (IRGPI).** To minimize the risk of overfitting, we applied a Cox proportional hazards regression model combined with the least absolute shrinkage and selection operator (glmnet, version 2.0-5). The penalty parameter was estimated by 10- fold cross-validation in the meta-training data set at 1 SE beyond the minimum partial likelihood deviance.

出自<https://jamanetwork.com/journals/jamaoncology/fullarticle/2643120>
from<https://jamanetwork.com/journals/jamaoncology/fullarticle/2643120>

# 应用场景

采用较为传统的方式构建基因对。小伙伴可以后续继续运行lasso或者其他模型构建算法，可参考FigureYa31lasso或FigureYa65SVM。

本文档作者参考例文的思路写了这篇文章，<https://onlinelibrary.wiley.com/doi/10.1002/ctm2.453>，小伙伴可参考。这篇文章里的多个图都可以用我们众筹的FigureYa实现：

- Figure 1E可参考FigureYa90subgroup，F可参考FigureYa35batch_bestSeparation；
- Figure 3G画法可参考FigureYa227boxdensity；
- Figure 4A可参考FigureYa187RMS，E可参考FigureYa173fancybar。

小丫画图群里的小伙伴们也写过类似的文章，例如<https://www.frontiersin.org/articles/10.3389/fonc.2021.665870/full>，其中多个图也可以用我们众筹的FigureYa实现：

- Figure 2B可参考FigureYa31lasso，C可参考FigureYa39bar；EG可参考FigureYa141risk；
- Figure 3AC可参考FigureYa35batch_bestSeparation；
- Figure 4A可参考FigureYa56immune_inflitration，B-E可参考FigureYa12box；
- Figure 5A可参考FigureYa193RiskTable，B-E可参考FigureYa30nomogram；
- Figure 6可以用clusterprofiler实现<https://github.com/YuLab-SMU/clusterProfiler-book>
- Figure 7可参考FigureYa71ssGSEA和FigureYa165heatmapPvalue；

类似的文章<https://www.sciencedirect.com/science/article/abs/pii/S088875432030971X>，对应的中文解读<https://mp.weixin.qq.com/s/-9xnZos9UVx4ySaZKBWF3Q>。用到的FigureYa：FigureYa69cancerSubtype、FigureYa66单因素cox、FigureYa141risk、FigureYa35batch_bestSeparation、FigureYa162boxViolin、FigureYa131CMap、FigureYa30nomogram

# Application Scenarios

Gene pairs were constructed in a more traditional way. You can continue to run lasso or other model construction algorithms in the future, please refer to FigureYa31lasso or FigureYa65SVM.

The author of this document wrote this article with reference to the idea of example texts, <https://onlinelibrary.wiley.com/doi/10.1002/ctm2.453>, small partners can refer to. Many of the diagrams in this article can be implemented with our crowdfunded FigureYa:

- Figure 1E can refer to FigureYa90subgroup, F can refer to FigureYa35batch_bestSeparation;
- Figure 3G can be drawn by FigureYa227boxdensity;
- For Figure 4A, see Figure Ya187RMS, and for E, see Figure Ya173fancybar.

The friends in the Xiaoya drawing group have also written similar articles, such as <https://www.frontiersin.org/articles/10.3389/fonc.2021.665870/full>, multiple of which can also be implemented with our crowdfunded FigureYa:

- Figure 2B can refer to FigureYa31lasso, C can refer to FigureYa39bar; For EG, please refer to FigureYa141risk;
- Figure 3AC can be found in FigureYa35batch_bestSeparation;
- Figure 4A can refer to FigureYa56immune_inflitration, B-E can refer to FigureYa12box;
- Figure 5A can refer to FigureYa193RiskTable, B-E can refer to FigureYa30nomogram;
- Figure 6 can be <https://github.com/YuLab-SMU/clusterProfiler-book> with clusterprofiler
- For Figure 7, refer to FigureYa71ssGSEA and FigureYa165heatmapPvalue;

Similar articles <https://www.sciencedirect.com/science/article/abs/pii/S088875432030971X>, corresponding Chinese interpretation <https://mp.weixin.qq.com/s/-9xnZos9UVx4ySaZKBWF3Q>。 FigureYa used: FigureYa69cancerSubtype, FigureYa66 one-factor cox, FigureYa141risk, FigureYa35batch_bestSeparation, FigureYa162boxViolin, FigureYa131CMap, FigureYa30nomogram

# 环境设置


# Environment settings


```{r}
source("install_dependencies.R")

```

加载包
load packages

```{r}
library(survival)

Sys.setenv(LANGUAGE = "en") #显示英文报错信息 # error messaes are displayed in English
options(stringsAsFactors = FALSE) #禁止chr转成factor # chr is not allowed to be converted to factor
```

加载自定义函数
Load custom functions
