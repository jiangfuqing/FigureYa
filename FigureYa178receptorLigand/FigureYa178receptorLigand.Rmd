---
title: "FigureYa178receptorLigand"
author: "Yandong Zheng"
reviewer: "Ying Ge, Junyi Shen"
date: "2025-5-20"
output: html_document
---
# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述

# Requirement

用本地CellPhoneDB分析配体-受体，用ggplot2重新画图。
Ligand-receptor analysis was performed using local CellPhoneDB, and the plot was redrawn using ggplot2.

![](example1.png)

出自<https://www.nature.com/articles/s41586-018-0698-6>
from<https://www.nature.com/articles/s41586-018-0698-6>

We next used **CellPhoneDB** to identify the expression of cytokines and chemokines by dNKs, and to predict their interactions with other cells at the maternal–fetal interface.

Fig. 5 | Multiple regulatory immune responses at the site of placentation. a, Overview of selected ligand–receptor interactions; P values indicated by circle size, scale on right (permutation test, see Methods). The means of the average expression level of interacting molecule 1 in cluster 1 and interacting molecule 2 in cluster 2 are indicated by colour. Only droplet data were used (n = 6 deciduas). Angio., angiogenesis. Assays were carried out at the mRNA level, but are extrapolated to protein interactions.

![](example2.png)

出自<https://science.sciencemag.org/content/365/6460/1461.full>
fromhttps://science.sciencemag.org/content/365/6460/1461.full

Fig. 4. Spatial topology of myeloid cell populations in the mature kidney. (A) Heat map of chemokine ligandreceptor interactions between mature myeloid and nephron cell types arranged by proximal to distal nephron organization. Point size indicates permutation p value (CellPhoneDB). Color indicates the scaled mean expression level of ligand and receptor (Mol1/2).

# 应用场景

# Application Scenarios

适用于单细胞转录组数据。跟网页版相比，本地安装运行CellPhoneDB更加灵活。
Applicable to single-cell transcriptome data. Compared with the web version, installing and running CellPhoneDB locally is more flexible.

可参考CellPhoneDB的作者发表的这篇Nature Protocol<https://doi.org/10.1038/s41596-020-0292-x>
Refer to the author published this Nature CellPhoneDB Protocol < https://doi.org/10.1038/s41596-020-0292-x

# 环境设置

# Environment Setup

加载R包
Load the R package

```{r}
source("install_dependencies.R")
library(data.table)
library(tidyverse)
library(dplyr)
library(ggplot2)

Sys.setenv(LANGUAGE = "en") #显示英文报错信息
options(stringsAsFactors = FALSE) #禁止chr转成factor
```

CellPhoneDB需要在终端（Linux、MAC系统）安装和运行。Windows用户用wsl<https://docs.microsoft.com/en-us/windows/wsl/install-win10>
CellPhoneDB needs to be installed and run on the terminal (Linux or MAC system). Windows users with WSL < https://docs.microsoft.com/en-us/windows/wsl/install-win10 >

安装CellPhoneDB，参考<https://github.com/Teichlab/cellphonedb>
Install CellPhoneDB, reference < https://github.com/Teichlab/cellphonedb >

```bash
#Installing CellPhoneDB
python -m venv cpdb-venv

#Activate virtualenv
source cpdb-venv/bin/activate

#Install CellPhoneDB
pip install cellphonedb
```

# 输入文件

# Input File

CellPhoneDB需要两个文件：
CellPhoneDB requires two files:

- test_meta.txt，两列，一列是每个细胞的barcode，一列是对应的细胞类型。
  test_meta.txt, two columns, one for the barcode of each cell and the other for the corresponding cell type.
- test_counts.txt，表达矩阵。
  test_counts.txt, expression matrix.

文章中raw data下载地址：表达矩阵<https://www.ebi.ac.uk/arrayexpress/files/E-MTAB-6701/E-MTAB-6701.processed.1.zip>
Article raw data download address: expressing matrix < https://www.ebi.ac.uk/arrayexpress/files/E-MTAB-6701/E-MTAB-6701.processed.1.zip >

meta文件<https://www.ebi.ac.uk/arrayexpress/files/E-MTAB-6701/E-MTAB-6701.processed.2.zip>
Meta files < https://www.ebi.ac.uk/arrayexpress/files/E-MTAB-6701/E-MTAB-6701.processed.2.zip >

经过以下处理，获得test_meta.txt和test_counts.txt文件。
After the following processing, the test_meta.txt and test_counts.txt files were obtained.
