---
title: "FigureYa246supervisedGDSC"
author: "Xiaofan Lu"
reviewer: "Ying Ge, Junyi Shen"
date: "2025-5-20"
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述

想众筹图5A B, 首先对TCGA数据集进行聚类分析，之后将GDSC细胞系按照TCGA聚类结果进行分组，分组后比较分组的药物敏感性，用AUC定量分析。

To crowdsource Figure 5A and B: first perform clustering on the TCGA dataset; then group GDSC cell lines according to the TCGA clustering results; after grouping, compare drug sensitivity between groups using AUC for quantitative analysis.

![](example.png)

出自<https://www.mdpi.com/2072-6694/13/9/2128>
From<https://www.mdpi.com/2072-6694/13/9/2128>

Figure 5. Drug discovery and immune characterization in essential gene-classified clusters of lung adenocarcinoma (LUAD).
(A) Heatmap showing essential gene-stratified-clusters exhibiting distinct expressions in GDSC lung cancer cells.
(B) Drug response area under the receiver operator characteristics curve (AUC) of SN-38 and talazoparib within essential geneclassified clusters demonstrated as a boxplot.

To identify **drugs** that exhibited distinct **efficacy in essential gene-classified clusters**, the prediction model was applied to the GDSC database (Figure 5A). Areas under the receiver operator characteristics curve (AUC) of drug responses within clusters were compared. Totally, the GDSC database contains 367 compounds. Only 257 compounds which were tested on more than 75% of the LUAD cell lines were used for analyses (Tables S8 and S9). AUCs of **SN-38, a topoisomerase I inhibitor, and talazoparib, a poly(ADP ribose) polymerase (PARP) inhibitor, were significantly lower in cluster 1 LUAD cells** (Figure 5B). This suggested that cluster 1 tumors with highly proliferative signatures were vulnerable to drugs targeting DNA-replication mechanisms.

# 应用场景

跟FigureYa240CRISPR是同一篇文章，FigureYa240CRISPR用CRISPR screening数据库找到肺癌细胞存活必需的31个基因，推演到TCGA数据库，发现这些基因在TCGA癌症vs正常时的确差异显著。
This is the same paper as FigureYa240CRISPR. FigureYa240CRISPR used a CRISPR screening database to find 31 genes essential for lung cancer cell survival, extrapolated to the TCGA database, and found these genes were indeed significantly different between TCGA cancer vs. normal.

> 这又有什么意义呢？能指导临床吗？ What’s the significance? Can it guide clinical practice?

这次从TCGA表达谱分出的亚型推演到GDSC数据库里的细胞系，由此推出各亚型的药物敏感性。
This time, subtypes derived from the TCGA expression profile are extrapolated to GDSC cell lines, thereby inferring drug sensitivity for each subtype.

# 环境设置


```{r}
source("install_dependencies.R")

install.packages("lolR")
```

加载包 Load packages

```{r}
library(pheatmap)
library(data.table)
library(ConsensusClusterPlus)
library(ComplexHeatmap)
library(lolR)
library(impute)
library(ggplot2)
library(ggpubr)
Sys.setenv(LANGUAGE = "en") #显示英文报错信息
options(stringsAsFactors = FALSE) #禁止chr转成factor
```

自定义函数 Custom function

```{r}
standarize.fun <- function(indata=NULL, halfwidth=NULL, centerFlag=T, scaleFlag=T) {
  outdata=t(scale(t(indata), center=centerFlag, scale=scaleFlag))
  if (!is.null(halfwidth)) {
    outdata[outdata>halfwidth]=halfwidth
    outdata[outdata<(-halfwidth)]= -halfwidth
  }
  return(outdata)
}
```

# 输入文件

大文件已上传至微云<https://share.weiyun.com/AW2ZOfhr>，建议小伙伴亲自去官网下载。
Large files have been uploaded to Weiyun; it’s recommended to download from the official sources yourself.

TCGA-LUAD.htseq_fpkm.tsv.gz，TCGA-LUAD的表达谱数据以及基因注释，源于<https://xenabrowser.net/datapages/?dataset=TCGA-LUAD.htseq_fpkm.tsv&host=https%3A%2F%2Fgdc.xenahubs.net&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443>

细胞系数据下载自DepMap，<https://depmap.org/portal/download/>：
Cell line data downloaded from DepMap:

- CCLE_RNAseq_rsem_genes_tpm_20180929.txt.gz，细胞系表达谱数据，源于<https://depmap.org/portal/download/api/download?file_name=ccle%2Fccle_2019%2FCCLE_RNAseq_rsem_genes_tpm_20180929.txt.gz&bucket=depmap-external-downloads>

- Cell_lines_annotations_20181226.txt，细胞系信息数据，源自<https://depmap.org/portal/download/api/download?file_name=ccle%2Fccle_2019%2FCell_lines_annotations_20181226.txt&bucket=depmap-external-downloads>

- sanger-dose-response.csv，GDSC细胞系药物敏感性数据源自<https://depmap.org/portal/download/api/download?file_name=processed_portal_downloads%2Fgdsc-drug-set-export-658c.5%2Fsanger-dose-response.csv&bucket=depmap-external-downloads>
