---
title: "FigureYa245VarDecompose"
author: "Jianing Gao"
reviewers: "Ying Ge,Hui Huang"
date: "2025-5-20"
output: html_document
---
# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述

我想众筹这篇文献的Fig.2b，使用RNA-seq来衡量基因的表达保守性。

基因在物种之间表达量的保守性，想用来分析非编码RNA在不同物种之间的表达保守性。

# Requirement Description

I would like to crowdfund Fig.2b of this article, using RNA-seq to measure the conserved expression of genes.

The conservation of gene expression between species was intended to analyze the expression conservation of non-coding RNAs between species.

![](example.png)

出自<https://www.nature.com/articles/nature13992>
from<https://www.nature.com/articles/nature13992>

Figure 2: Comparative analysis of the gene expression programs in human and mouse samples.

b, Gene expression variance decomposition (see Methods) estimates the relative contribution of tissue and species to the observed variance in gene expression for each orthologous human–mouse gene pair. Green dots indicate genes with **higher between-tissue contribution** and red dots genes with **higher between-species contributions**.

Our initial analyses revealed that gene expression patterns tended to cluster more by species rather than by tissue (Fig. 2a). To resolve the sets of genes contributing to different components in the clustering, we employed variance decomposition (see Methods) to estimate, for each orthologous human–mouse gene pair, the proportion of the variance in expression that is contributed by tissue and by species (Fig. 2b). This analysis revealed the sets of genes **whose expression varies more across tissues than between species**, and those **whose expression varies more between species than across tissues**. As expected, **the clustering of the RNA-seq samples is dominated either by species or tissues**, depending on the gene set employed (Extended Data Fig. 1a, b). Furthermore, removal of the ~4,800 genes that drive the species-specific clustering (see ref. 47, Supplementary Fig. 1d therein) or normalization methods that reduce the species effects reveal tissue-specific patterns of expression in the same samples (Extended Data Fig. 1c).

作者通过对人和鼠10个不同的组织的转录组数据通过PCA（Fig.2a，画法可参考FigureYa101PCA）评估了基因表达在人鼠之间的保守性，发现样本主要按照物种而不是组织分开，这表明人鼠之间的基因表达差异大于组织之间的差异。随后作者通过方差分解（线性混合模型）计算了组织和物种对基因表达方差的贡献，鉴定出了人鼠表达保守和人鼠表达差异的基因（Fig.2b）。在剔除了人鼠表达差异的基因后，PCA的结果表明样本按照组织而不是物种分布（Extend Fig.1c）。

The authors evaluated the conservation of gene expression between humans and mice by PCA (Fig.2a, see FigureYa101PCA) on transcriptome data from 10 different tissues of humans and mice, and found that the samples were mainly separated by species rather than tissues, indicating that the differences in gene expression between humans and mice were greater than the differences between tissues. The authors then calculated the contribution of tissues and species to the variance of gene expression by variance decomposition (linear mixed model) and identified genes with conservative human-mouse expression and differential human-mouse expression (Fig.2b). After culling the differentially expressed genes in humans and mice, the results of PCA showed that the samples were distributed by tissue rather than species (Extend Fig.1c).

# 应用场景

Fig.2b的方法具有普适性，对于研究某基因在物种之间表达的保守性有指导意义。如果某基因的表达水平在人鼠之间不保守，可能提示着该基因突变造成的效应在人鼠之间有差异。此时运用小鼠作为模式生物得到的结论泛化到人上时，需要特别谨慎。

# Application Scenarios

Fig.2b's method is universal and has guiding significance for studying the conserved expression of a gene between species. If the expression level of a gene is not conserved between humans and mice, it may indicate that the effects of the gene mutation are different between humans and mice. At this point, special caution is required when generalizing conclusions from mice as model organisms to humans.

original text：Categorizing orthologous gene pairs into these groups should enable more informative translation of research results between mouse and human. In particular, for **gene pairs whose variance in expression is largest between tissues (and less between species), mouse should be a particularly informative model for human biology**. In contrast, interpretation of studies involving **genes whose variance in expression is larger between species needs to take into account the species variation**. The relative contributions of species-specific and tissue-specific factors to each gene’s expression are further explored in two associated papers37,47.

本脚本主要实现了以下功能：

1) 按照直系同源关系（one2one orthologs）合并人鼠转录组
2) 数据重构，使之方便应用线性混合模型
3) 利用并行计算批量对每个基因构建线性混合模型，并计算物种和组织两个随机效应分别对基因表达方差的贡献
4) 绘图，复现Fig.2b

This script implements the following functions:

1) Merge the human and mouse transcriptomes according to the orthologous relationship (one2one orthologs).
2) Data reconstruction to facilitate the application of linear hybrid models
3) Parallel computational batches were used to construct a linear mixed model for each gene, and the contribution of two random effects, species and tissue, to the variance of gene expression was calculated
4) Drawing, reproduction Fig.2b

# 环境设置


# Environment settings


```{r}
source("install_dependencies.R")
```

```{r eval=FALSE}

install.packages(c("foreach", "doParallel"))
```

加载包
load packages

```{r}
suppressPackageStartupMessages({
  library(tidyverse)
  library(lme4) # 用于实现linear mixed model (LMM) # Used to implement linear mixed model (LMM)
})
Sys.setenv(LANGUAGE = "en") #显示英文报错信息 # error messages are displayed in English
options(stringsAsFactors = FALSE) #禁止chr转成factor # chr is not allowed to be converted to factor
```

# 输入文件

human.tissue.fpkm.rds和mouse.tissue.fpkm.rds，人和鼠各器官的表达矩阵。

human2mouse.ortholog.txt，人和鼠同源基因的对应关系。

# Input files

human.tissue.fpkm.rds and mouse.tissue.fpkm.rds, expression matrices of human and mouse organs.

human2mouse.ortholog.txt, correspondence between human and mouse homologous genes.
