---
title: "FigureYa71ssGSEA_update"
author: "Rongfang Shen, Taojun Ye"
reviewer: "Ying Ge"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# 设置knitr代码块的全局选项 / Set global options for knitr code chunks
```

## 需求描述
输入TCGA数据，用原文的方法计算，原图复现。

## Requirement Description
Input TCGA data and compute it using the method of the original text, reproduced in the original figure.

![](example.png)

出自<https://doi.org/10.3389/fimmu.2018.01578>

from<https://doi.org/10.3389/fimmu.2018.01578>

## 应用场景
关于量化浸润免疫细胞，2018年发表在Cancer Immunol Immunother中的一篇综述概况了目前所用的几种方法：[Quantifying tumor-infiltrating immune cells from transcriptomics data](https://link.springer.com/article/10.1007%2Fs00262-018-2150-z)。

ssGSEA量化免疫细胞浸润最大的一个优点就是自己可以定制量化免疫浸润细胞种类。像MCPcounter只能量化10种免疫细胞，cibersort量化22种细胞，但是目前平台只限于用在芯片数据，虽然很多RNA-seq数据也直接用了。

ssGSEA只要你有marker genes就可以量化。**注意：**量化出来的结果是不可以跨数据比较的，就跟转录组的批次效应一样。

目前公认并且用的最多的免疫细胞marker就是2013年发表在Immunity上的[SpatiotemporalDynamicsof IntratumoralImmuneCells Reveal the Immune Landscape in Human Cancer](https://linkinghub.elsevier.com/retrieve/pii/S1074-7613(13)00437-8) 所提供的免疫细胞marker genes（Table S1），能提取到24种免疫细胞信息。下文用的是这24种免疫细胞。

例文提取了27种免疫细胞，联系原作者能获得27种免疫细胞表面marker genes。输入原作者提供的这些marker genes来跑这套代码，结果基本同原文一致，可以很好的分为3类。

## Application Scenarios
With regard to quantifying infiltrating immune cells, a 2018 review published in Cancer Immunol Immunother provides an overview of several methods currently used:[Quantifying tumor-infiltrating immune cells from transcriptomics data]( https://link.springer.com/article/10.1007%2Fs00262-018-2150-z).

One of the biggest advantages of ssGSEA for quantifying immune cell infiltration is that one can customize the quantification of immune infiltrating cell types. Like MCPcounter can only quantify 10 types of immune cells, cibersort quantifies 22 types of cells, but currently the platform is limited to microarray data, although many RNA-seq data are also used directly.

ssGSEA can quantify as long as you have marker genes. **Note:** The results from quantification are not comparable across data, just like the batch effect on the transcriptome.

The currently recognized and most used immune cell marker is [SpatiotemporalDynamicsof IntratumoralImmuneCells Reveal the Immune Landscape in Human Cancer] published in Immunity in 2013 ( https://linkinghub.elsevier.com/retrieve/pii/S1074-7613(13)00437-8) The immune cell marker genes (Table S1) provided by https://linkinghub.elsevier.com/retrieve/pii/S1074-7613(13)00437-8) were able to extract information on 24 immune cells. These 24 immune cells are used in the following text.

The example paper extracted 27 kinds of immune cells, contacting the original author can get 27 kinds of immune cell surface marker genes. input these marker genes provided by the original author to run this set of code, the result is basically the same as the original article, and it can be well categorized into 3 classes.

![](Immunother.png)

## 环境设置


## Environment settings


```r

BiocManager::install("GSVA")
install.packages("circlize")
```

加载包

library packages

```{r}
source("install_dependencies.R")
# 加载生物信息学分析所需的R包 / Load R packages for bioinformatics analysis
library(GSVA)          # 基因集变异分析 / Gene Set Variation Analysis
library(org.Hs.eg.db)
library(TCGAbiolinks)   # TCGA数据下载与处理 / TCGA data download and processing
library(ComplexHeatmap) # 复杂热图绘制 / Complex heatmap visualization
library(dplyr)         # 数据操作与转换 / Data manipulation and transformation
library(stringr)       # 字符串处理 / String manipulation
library(rtracklayer)   # 基因组数据交互 / Genomic data interoperability
library(SummarizedExperiment) # 基因组数据容器 / Genomic data container
library(clusterProfiler) # 聚类分析与可视化 / Cluster profiling and visualization
library(RColorBrewer)  # 颜色调色板 / Color palettes
library(maftools)      # MAF文件分析与可视化 / MAF file analysis and visualization
library(circlize)      # 环形可视化 / Circular visualization
library(matrixStats)   # 矩阵统计运算 / Matrix statistical operations
library(GetoptLong)    # 字符串插值 / String interpolation
library(GenomicRanges) # 基因组范围操作 / Genomic ranges manipulation

# 设置系统环境参数 / Set system environment parameters
Sys.setenv(LANGUAGE = "en")  # 强制显示英文报错信息 / Force English error messages
options(stringsAsFactors = FALSE)  # 防止字符自动转为因子 / Prevent automatic conversion of strings to factors
```

## 输入数据预处理

用ssGSEA量化免疫浸润，需要两个输入数据：

- easy_input_immunity.rdata，24种免疫细胞marker genes的ENTREZ ID，保存为list。来源：[2013 Immunity那篇文章的Table S1](https://www.cell.com/cms/10.1016/j.immuni.2013.10.003/attachment/8dc04d32-6aff-4eda-99f5-6401bcae9751/mmc1.pdf)，手动整理成csv格式，并用GPL96（HG-U133A Affymetrix platform）按照探针得到gene symbol，文章有提到这批数据是从这个芯片平台得到的。

- easy_input_expr.csv，基因表达矩阵，每行一个基因，每列一个sample。第一列基因ID跟easy_input_immunity.rdata里的基因ID一致，此处都用ENTREZ ID。文件太大，请从微云下载easy_input_expr.csv和not_easy_input_expr.csv：<https://share.weiyun.com/5EsD2Ek>

**如果你已经准备好了这两个文件，就可以直接进入“用ssGSEA来量化浸润水平”。**

下面带你获得这两个输入文件：

## Input data preprocessing

Quantifying immune infiltration with ssGSEA requires two input data:

- easy_input_immunity.rdata, ENTREZ IDs of 24 immune cell marker genes, saved as a list. source:[Table S1 of the 2013 Immunity article](https://www.cell.com/cms/10.1016/j. immuni.2013.10.003/attachment/8dc04d32-6aff-4eda-99f5-6401bcae9751/mmc1.pdf), manually organized into csv format, and used GPL96 (HG-U133A Affymetrix platform) to get the gene symbol, the article has mentioned that this batch of data was obtained from this chip platform.

- easy_input_expr.csv, gene expression matrix, one gene per row, one sample per column, the first column gene ID is the same as the gene ID in easy_input_immunity.rdata, and ENTREZ ID is used here. the file is too big, please download easy_input_expr. csv and not_easy_input_expr. csv from Weiyun. csv and not_easy_input_expr.csv: <https://share.weiyun.com/5EsD2Ek>

**If you have these two files ready, you can go directly to “Quantifying infiltration levels with ssGSEA”. **

The following takes you to the two input files:

### 免疫细胞marker genes

这步获得的easy_input_immunity.rdata里面是各种免疫细胞marker genes list，可重复使用。

### Immune cell marker genes

The easy_input_immunity.rdata obtained in this step contains a list of various immune cell marker genes that can be reused.
