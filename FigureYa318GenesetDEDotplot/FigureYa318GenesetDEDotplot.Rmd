---
title: "FigureYa318GenesetDEDotplot"
params:
  author: "Xiaofan Lu; Yasi Zhang"
  reviewer: "Ying Ge"
  date: "2025-05-20"
output: html_document
---

**Author(s)**: `r params$author`
**Reviewer(s)**: `r params$reviewer`
**Date**: `r params$date`

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述
# Requirements Description

代谢分析最后的f图，他是怎么算70多条代谢通路在单细胞里面跟其他基因集相关性的。

The final figure f in the metabolic analysis, how does it calculate the correlation between over 70 metabolic pathways and other gene sets in single cells.

![](example.png)

出自：<https://bmcbiol.biomedcentral.com/articles/10.1186/s12915-023-01540-2>

图1 利用单细胞RNA测序解析动脉粥样硬化的免疫图谱
(f) 点图显示AC和PA组织中全局细胞类型间差异富集的通路

Source: <https://bmcbiol.biomedcentral.com/articles/10.1186/s12915-023-01540-2>

Fig. 1 Dissection of the immune landscape in atherosclerosis with scRNA-seq.
(f) Dot plots showing differentially enriched pathways in the global cell type between AC and PA tissues

# 应用场景
# Application Scenario

根据单细胞数据，计算不同细胞类型中两组间通路活性得分，并绘制差异分析点图(Fig.1 f)。点的大小表示显著性（padj或FDR等），点的颜色表示logFC。

Figure 1e，细胞比例分布特异度（Ro/e）折线图，可参考FigureYa317RoeDot <https://k.youshop10.com/Qn2Wb5MU>。

Based on single-cell data, pathway activity scores between the two groups were calculated across different cell types, and differential analysis dot plots were generated (Fig. 1f). Dot size represents significance (e.g., padj or FDR), while dot color indicates logFC.

Figure 1e displays the cell proportion distribution specificity (Ro/e) line graph, which can be referenced to FigureYa317RoeDot <https://k.youshop10.com/Qn2Wb5MU>.

# 环境设置
# Environment Setup


```{r}
source("install_dependencies.R")
```

```{r eval=FALSE}

install.packages("BiocManager")
install.packages("SeuratObject")
BiocManager::install("GEOquery")
BiocManager::install("AUCell")
BiocManager::install("clusterProfiler")
BiocManager::install("limma")
BiocManager::install("GSVA")
```

# 加载包
# Loading packages

```{r}
library(Seurat)
library(magrittr)
library(GEOquery)
library(plyr)
library(openxlsx)
library(GSVA)
library(AUCell)
library(clusterProfiler)
library(limma)
library(ggplot2)
library(dplyr)
library(cowplot)

# 显示英文报错信息
# Show English error messages
Sys.setenv(LANGUAGE = "en")

# 禁止chr转成factor
# Prevent character-to-factor conversion
options(stringsAsFactors = FALSE)
```

# 输入文件
# Input Files

Seurat对象：这步跟FigureYa317RoeDot相同。包含样本来源（Group）和细胞类型（Celltypes）信息。从GEO下载输入数据，<https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE159677>，下载Supplementary file表格里的`GSE159677_RAW.tar`，和Download family里的`Series Matrix File(s)`，存放在InputData文件夹里。也可以从语雀下载<https://www.yuque.com/figureya/figureyaplus/easyinput>

Seurat object: This step is the same as FigureYa317RoeDot. It contains sample source (Group) and cell type (Celltypes) information. Download input data from GEO, <https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE159677>, download `GSE159677_RAW.tar` from the Supplementary file table, and `Series Matrix File(s)` from Download family, and store them in the InputData folder. You can also download from Yuque<https://www.yuque.com/figureya/figureyaplus/easyinput>.

![](InputData.png)

h.all.v7.5.1.symbols.gmt，基因集文件，存放基因与通路的关联关系

GenesetInfo.txt，通路信息文件，标识通路及其所属分类

h.all.v7.5.1.symbols.gmt - Gene set file containing gene-pathway associations

GenesetInfo.txt - Pathway information file identifying pathways and their respective categories
