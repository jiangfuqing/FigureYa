---
title: "FigureYa291PancanProgSigatureV2"
params:
  author: "Xiaofan Lu; Yasi Zhang"
  reviewer: "Ying Ge"
  date: "2025-05-20"
output: html_document
---

**Author(s)**: `r params$author`
**Reviewer(s)**: `r params$reviewer`
**Date**: `r params$date`

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述
# Demand description

来自这篇A signature for pan-cancer prognosis based on neutrophil extracellular traps，输入数据是Table S1中基因在pan-cancer的表达，使用lasso回归输出Training set和Testing set中的这张Figure 2A在不同癌症中的signature的risk score同时生成Figure2B中的HR和CI值。

From the article "A signature for pan-cancer prognosis based on neutrophil extracellular traps," the input data is the expression of genes in Table S1 across pan-cancer. Using LASSO regression, the output includes the risk scores of the signature in different cancers for the Training set and Testing set as shown in Figure 2A, while also generating the HR and CI values in Figure 2B.

![](example.png)

出自<https://jitc.bmj.com/content/10/6/e004210.long>

图2 基于19个基因的NETs评分的预后预测效果。

Source: <https://jitc.bmj.com/content/10/6/e004210.long>

Figure 2 Prognostic performance of the 19-gene NETs score.

# 应用场景
# Application scenarios

在泛癌中计算某感兴趣得分并计算该得分与预后的相关性；绘制得分分布于预后散点图。

更多泛癌FigureYa看这里 <https://k.youshop10.com/C8RkTgR3>

可以用FigureYa实现例文多个Figure，例如：

- Figure 1A，可参考FigureYa31lasso
- Figure 2CDE、3、6BCDE，可参考FigureYa35batch_bestSeparation
- Figure 4AB，可参考FigureYa30
- Figure 4C，可参考FigureYa85timeROC
- Figure 4D，可参考FigureYa33DCA
- Figure 5相关性结果展示，可参考 <https://k.youshop10.com/Eig1YOB4>
- Figure 2B、6FGH森林图，可参考 <https://k.youshop10.com/Bc4bKvk3>

Pan-cancer analysis: Calculate a score of interest and evaluate its correlation with prognosis; generate scatter plots showing the distribution of the score against prognostic outcomes.

For more pan-cancer FigureYa examples, visit: <https://k.youshop10.com/C8RkTgR3>

FigureYa can be used to reproduce multiple figures from the example article, such as:

- Figure 1A → Refer to FigureYa31lasso
- Figures 2CDE, 3, 6BCDE → Refer to FigureYa35batch_bestSeparation
- Figures 4AB → Refer to FigureYa30
- Figure 4C → Refer to FigureYa85timeROC
- Figure 4D → Refer to FigureYa33DCA
- Figure 5 (correlation results) → See <https://k.youshop10.com/Eig1YOB4>
- Figures 2B & 6FGH (forest plots) → See <https://k.youshop10.com/Bc4bKvk3>

# 环境设置
# Environment Setup


```{r}
source("install_dependencies.R")

```

# 加载包
# Loading packages

```{r}
library(ggplot2)
library(data.table)
library(survival)
library(cowplot)
library(ggpubr)

# 显示英文报错信息
# Show English error messages
Sys.setenv(LANGUAGE = "en")

# 禁止chr转成factor
# Prevent character-to-factor conversion
options(stringsAsFactors = FALSE)
```

# 输入文件
# Input Files

table s6 risk coefficients.txt，风险基因以及对应系数，来自原文补充材料表格Table S6。

merged_sample_quality_annotations.tsv，肿瘤注释文件。下载自<https://gdc.cancer.gov/about-data/publications/pancanatlas>，下载地址<http://api.gdc.cancer.gov/data/1a7d7be8-675d-4e60-a105-19d4121bdebf>。

EBPlusPlusAdjustPANCAN_IlluminaHiSeq_RNASeqV2.geneExp.tsv，表达矩阵，第一列是基因，之后是其在每个样本中的表达量。下载自<http://api.gdc.cancer.gov/data/3586c0da-64d0-4b74-a449-5ff4d9136611>。跟FigureYa286ExprCorORR所用的是同一个文件，不用重复下载。

Survival_SupplementalTable_S1_20171025_xena_sp，生存数据。来自<https://xenabrowser.net/datapages/?dataset=Survival_SupplementalTable_S1_20171025_xena_sp&host=https%3A%2F%2Fpancanatlas.xenahubs.net&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443>。

table s6 risk coefficients.txt - Risk genes and their corresponding coefficients, sourced from Supplementary Table S6 of the original publication.

merged_sample_quality_annotations.tsv - Tumor annotation file. Downloaded from <https://gdc.cancer.gov/about-data/publications/pancanatlas>, direct download link: <http://api.gdc.cancer.gov/data/1a7d7be8-675d-4e60-a105-19d4121bdebf>.

EBPlusPlusAdjustPANCAN_IlluminaHiSeq_RNASeqV2.geneExp.tsv - Expression matrix where the first column contains gene names followed by their expression values in each sample. Downloaded from <http://api.gdc.cancer.gov/data/3586c0da-64d0-4b74-a449-5ff4d9136611>. This is the same file used in FigureYa286ExprCorORR, so no need to download it again.

Survival_SupplementalTable_S1_20171025_xena_sp - Survival data. Obtained from <https://xenabrowser.net/datapages/?dataset=Survival_SupplementalTable_S1_20171025_xena_sp&host=https%3A%2F%2Fpancanatlas.xenahubs.net&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443>.
