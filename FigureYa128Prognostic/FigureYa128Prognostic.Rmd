---
title: "FigureYa128Prognostic"
author: "Xiaofan Lu, Taojun Ye"
reviewer: "Ying Ge"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# 设置knitr代码块的全局选项 / Set global options for knitr code chunks
```

## 需求描述

文章中的那7个基因咋选出来的？

出自<https://clincancerres.aacrjournals.org/content/18/21/6001>

这里有文章解读：<https://www.jianshu.com/p/58eab0d8ac22?from=singlemessage&isappinstalled=0>

## Requirement description

How were the 7 genes selected in the article?

From< https://clincancerres.aacrjournals.org/content/18/21/6001 >

Here is an article interpretation:< https://www.jianshu.com/p/58eab0d8ac22?from=singlemessage&isappinstalled=0 >

## 应用场景

找marker基因。

通过迭代LASSO产生“共识”下被保留的基因，进一步通过AUC选择与生存相关的最小基因组合。

**小伙伴跟作者间的问答记录：**

问：迭代lasso的原理是什么？

答：lasso在允许的时候高度依赖种子，因为你需要交叉验证，而交叉验证的过程是随机选取样本的。所以一旦你更换了种子，最优lambda就会改变，最终得到的特征就会改变。共识就是在多次运行lasso（不依赖种子）后，那么高频次被保留下的特征，可以认为是对感兴趣话题最有影响的。因为如果我运行500次，A特征出现了300次，和B特征出现了30次，它们的重要程度肯定是不同的。不是选共同的，是对频次排序，这是我的理解。频次的顺序代表了这些特征的影响程度，然后依次把这些特征纳入cox模型，当AUROC达到峰值的时候停止纳入，此时模型最优，并且所含特征最少。

## Application scenarios

Find marker genes.

By iterating LASSO to generate genes that are retained under the consensus, the minimum gene combination related to survival is further selected through AUC.

**Q&A record between the friend and the author:**

Q: What is the principle of iterating lasso?

Answer: lasso heavily relies on seeds when allowed, as you need cross validation, which involves randomly selecting samples. So once you change the seed, the optimal lambda will change, and the final features obtained will change. Consensus is that after running lasso multiple times (without relying on seeds), the high-frequency features preserved can be considered the most influential on the topic of interest. Because if I run it 500 times and feature A appears 300 times and feature B appears 30 times, their importance levels will definitely be different. It's not about choosing common ones, it's about sorting by frequency, that's my understanding. The order of frequency represents the degree of influence of these features, and then these features are sequentially included in the Cox model. When the AUROC reaches its peak, the inclusion stops, and the model is optimal with the least number of features.

## 环境设置


## Environment settings

### Install and load packages using domestic images

```{r}
source("install_dependencies.R")

# Set Bioconductor mirror to University of Science and Technology of China mirror source

# Check and load/install survival package - for survival analysis
if(!require(survival)){
  install.packages("survival")
} else {library(survival)}

# 检查并加载/安装glmnet包 - 用于正则化广义线性模型
# Check and load/install glmnet package - for regularized generalized linear models
if(!require(glmnet)){
  install.packages("glmnet")
} else {library(glmnet)}

# 检查并加载/安装pbapply包 - 用于并行计算和进度条显示
# Check and load/install pbapply package - for parallel computation and progress bar display
if(!require(pbapply)){
  install.packages("pbapply")
} else {library(pbapply)}

# 检查并加载/安装survivalROC包 - 用于生存分析中的ROC曲线
# Check and load/install survivalROC package - for ROC curves in survival analysis
if(!require(survivalROC)){
  install.packages("survivalROC")
} else {library(survivalROC)}

# 设置环境语言为英文，确保报错信息为英文
# Set environment language to English to ensure error messages are in English
Sys.setenv(LANGUAGE = "en")

# 禁止字符串自动转换为因子，提高数据处理稳定性
# Disable automatic conversion of strings to factors for more stable data processing
options(stringsAsFactors = FALSE)
```

### 自定义函数

### Custom functions
