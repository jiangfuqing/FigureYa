---
title: "FigureYa214KEGG_hierarchyV2"
author: "Zongcheng Li"
reviewers: "Ying Ge,Hui Huang"
date: "2025-5-20"
output: html_document
---
# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述

富集分析，右侧的kegg画出了三层

# Requirement Description

For enrichment analysis, the kegg on the right draws three layers

![](example.png)

出自<https://doi.org/10.1186/s40168-019-0629-2>
from<https://doi.org/10.1186/s40168-019-0629-2>

Fig. 4 Significantly (P < 0.05) different
KO functional categories that were significantly enriched in GSH or GSL were separately analyzed for KEGG pathway enrichment; those pathways that did not belong to microorganisms were removed; **all significantly enriched pathways** are described in (c).
KO functional categories and pathways that were **significantly enriched in GSH are shown in red**; those **significantly enriched in GSL are shown in green**

# 应用场景

富集分析得到太多term，其中好多还是相似的，怎样合理的合并？clusterProfiler有一个simplify函数，能给富集分析结果瘦身by removing redundancy of enriched GO terms，但有时瘦的不够多。

- GO富集分析可以用FigureYa80GOclustering，用GOSemSim计算GO term之间的相似性，但是只能合并GO注释，对其他来源的注释无能为力。
- 合并来源于不同数据库的term，可参考FigureYa88DAVIDkappa
- 本文做KEGG富集分析，直接用第一层和第二层的term归类。

另外，Fig. 4B的画法可参考FigureYa142circosBar。

# Application Scenarios

The enrichment analysis yields too many terms, many of which are still similar, how to merge them reasonably? The clusterProfiler has a simplify function that slims down the enrichment analysis results by removing redundancy of enriched GO terms, but sometimes not enough thin.

- GO enrichment analysis can be done with FigureYa80GOclustering, and GOSemSim can be used to calculate the similarity between GO terms, but only GO annotations can be merged, and annotations from other sources cannot be consolidated.
- Merge terms from different databases, see FigureYa88DAVIDkappa
- In this paper, KEGG enrichment analysis is performed and the terms of the first and second layers are directly classified.

In addition, the drawing method of Fig. 4B can be found in Figure Ya142circosBar.

# 环境设置


# Environment settings


```{r}
source("install_dependencies.R")
```

```{r eval=FALSE}

install.packages("tidyjson")
```

加载包
load packages

```{r}
library(tidyjson)
library(jsonlite)
library(dplyr)
library(tidyr)
library(clusterProfiler)
library(ggplot2)
Sys.setenv(LANGUAGE = "en") #显示英文报错信息 # error messages are displayed in English
options(stringsAsFactors = FALSE) #禁止chr转成factor # chr is not allowed to be converted to factor
```

# 提取KEGG的三层注释

这里提取的是最新版本KEGG的三个level的注释信息，保存到kegg_hierarchy.csv文件。

从KEGG官网下载json file，<https://www.kegg.jp/kegg-bin/get_htext?br08901.keg>

# Extract the three-layer annotations of KEGG

Here is the annotation information of the three levels of the latest version of KEGG, which is saved to a kegg_hierarchy.csv file.

Download the json file from the KEGG official website and <https://www.kegg.jp/kegg-bin/get_htext?br08901.keg>

![](download.png)

关于json file，看这里<https://mran.microsoft.com/snapshot/2016-10-12/web/packages/tidyjson/vignettes/introduction-to-tidyjson.html>

For JSON files, see here<https://mran.microsoft.com/snapshot/2016-10-12/web/packages/tidyjson/vignettes/introduction-to-tidyjson.html>
