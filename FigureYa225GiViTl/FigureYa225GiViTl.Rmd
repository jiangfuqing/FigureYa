---
title: "FigureYa225GiViTl"
author: "Jiawei Shi"
reviewers: "Ying Ge,Hui Huang"
date: "2025-5-20"
output: html_document
---
# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述

用givitiR包复现文章里的图

# Requirement Description

Use the givitiR package to reproduce the diagram in the article

![](example1.png)

出自<https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0201515>
from<https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0201515>

Fig 4. Calibration plots of the nomogram for the probability of urosepsis patients with ureteral calculi in the development group and validation group.

相似的图：
Similar diagrams:

![](example2.png)

出自<https://link.springer.com/article/10.1007/s00134-012-2578-0>
from<https://link.springer.com/article/10.1007/s00134-012-2578-0>

# 应用场景
# Application Scenarios

**Functions to assess the calibration of logistic regression models** with the GiViTI (Gruppo Italiano per la Valutazione degli interventi in Terapia Intensiva, Italian Group for the Evaluation of the Interventions in Intensive Care Units - see <http://www.giviti.marionegri.it/>) approach. The approach consists in a graphical tool, namely the GiViTI calibration belt, and in the associated statistical test. These tools can be used both to evaluate the internal calibration (i.e. the goodness of fit) and to assess the validity of an externally developed model.

引自givitiR包的[首页简介](https://cran.r-project.org/web/packages/givitiR/index.html)

原文method说是用rms包实现的，rms包功能确实强大，我初步查阅了[rms包的Reference manual](https://cran.r-project.org/web/packages/rms/rms.pdf)并没有发现绘制GiViTI calibration belt的函数，我推测作者应该是写错了，查阅文献后，发现应该是通过givitiR包绘制的。

Quote from the [Home Introduction] of the givitiR package (https://cran.r-project.org/web/packages/givitiR/index.html)

The original method said that it was implemented with the rms package, the rms package is really powerful, I initially checked the [rms package Reference manual](https://cran.r-project.org/web/packages/rms/rms.pdf) and did not find the function of drawing the GiViTI calibration belt, I speculate that the author should have written it wrong, after consulting the literature, The discovery should be drawn through the givitiR package.

![](method.png)

# 环境设置


# Environment settings


```{r}
source("install_dependencies.R")

```

加载包
load packages

```{r}
library(givitiR)  # 绘制GiViTI calibration belt # Draw the GiViTI calibration belt
library(foreign)  # 读入sav格式文件 # Load the SAV file
library(rms)      # 拟合模型 # Fitting the model
library(ResourceSelection) # Hosmer-Lemeshow拟合优度检验 # Hosmer-Lemeshow goodness-of-fit test

Sys.setenv(LANGUAGE = "en") #显示英文报错信息  # error messages are displayed in English
options(stringsAsFactors = FALSE) #禁止chr转成factor # chr is not allowed to be converted to factor
```

# 输入文件

例文旨在开发一个预测尿脓毒症的个性化模型，结局事件是尿脓毒症，并且纳入了性别、肾积水平均CT值、功能性孤立肾、尿WBC数、尿亚硝酸盐等五个因素

easyinput_train.csv和easyinput_test.csv，分别为训练集和验证集临床信息。构建模型需要这几列：

- 结局事件：Urosepsis
- 因素：这里有五个Gender、Functional_solitary_kidney、Mean_CT_value_of_hedronephrosis、Urine_WBC_count、Urine_nitrite

另外，PRE_1列是例文模型的预测概率，用我们复现的预测概率值跟它做比较，即可看出我们复现的效果。我们最后也像这样输出预测概率，放到最后一列（见output_*.csv），可作为文章的补充材料。

下载自[训练集](https://ndownloader.figstatic.com/files/12624572)和[验证集](https://ndownloader.figstatic.com/files/12624578)，下载后重命名为train set 和test set，为sav格式（SPSS）。为方便小伙伴套用到自己到数据上，把它们转成csv格式。

# Input files

The aim of this article was to develop a personalized model for predicting urinary sepsis, with the outcome event of urinary sepsis and including five factors: gender, hydronephrosis CT value, functional solitary kidney, urine WBC number, and urine nitrite

easyinput_train.csv and easyinput_test.csv, respectively, are the training set and the validation set of clinical information. These columns are required to build the model:

- Ending Event: Urosepsis
- Factors: There are five Gender, Functional_solitary_kidney, Mean_CT_value_of_hedronephrosis, Urine_WBC_count, and Urine_nitrite

In addition, column PRE_1 is the prediction probability of the example model, and we can see the effect of our recurrence by comparing it with the prediction probability value of our recurrence. We also output the predicted probabilities like this at the end and put them in the last column (see output_*.csv) as a supplement to the article.

It was downloaded from [Training Set] (https://ndownloader.figstatic.com/files/12624572) and [Validation Set] (https://ndownloader.figstatic.com/files/12624578), renamed to train set and test set, and in sav format (SPSS). In order to facilitate the small partners to apply their own data, convert them to CSV format.
