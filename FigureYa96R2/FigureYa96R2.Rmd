---
title: "FigureYa96R2"
author: "Shipeng Guo, Taojun Ye"
reviewer: "Ying Ge"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# 设置knitr的全局代码块选项 / Set global chunk options for knitr
```

## 需求描述

FigureYa92immune_gene只是1个基因跟免疫浸润的关系。我想要展示两个基因表达跟免疫浸润高/低的关系。

左右两侧纵坐标分别展示两个基因的表达量；横坐标按其中一个基因排序，两种颜色展示高/低免疫浸润，可以用FigureYa71ssGSEA热图中对高/低免疫浸润的结果作为输入。

## Requirement Description

FigureYa92immune_gene is just 1 gene in relation to immune infiltration. I want to show the relationship between the expression of two genes and the high/low immune infiltration.

The left and right vertical coordinates show the expression of the two genes; the horizontal coordinates are sorted by one of the genes, and the two colors show the high/low immune infiltration, which can be used as inputs with the results of the FigureYa71ssGSEA heatmap for high/low immune infiltration.

![](example.png)

出自<https://www.nature.com/articles/s41467-018-06648-6>

from<https://www.nature.com/articles/s41467-018-06648-6>

## 应用场景

评价基因对免疫浸润的影响；

批量筛选出影响免疫浸润的候选基因；

同样适用于展示转录因子和靶基因表达调控的关系。

在“小丫画图”公众号回复“R2”，查看如何将这个图用在paper里。

## Application Scenarios

Evaluate the effect of genes on immune infiltration;

Batch screening of candidate genes affecting immune infiltration;

It is also applicable to show the relationship between transcription factors and target gene expression regulation.

Reply “R2” in “Xiaoya Drawing” public number to see how to use this diagram in the paper.

## 输入文件的获得

如果你的数据已经整理成very_easy_input.csv的格式，就可以跳过这步，直接进入“开始画图”。

这里基于免疫细胞矩阵把样品分为两类，并把分类信息加到基因表达矩阵里。要求两个文件的样本名一致：

- ssGSEA_output.csv，免疫细胞矩阵，列是免疫细胞，行是样本，由FigureYa71ssGSEA产生。目的是给样品分类，可以换成其他临床信息、突变信息等等。
- easy_input_expr.csv，基因表达矩阵，列是样本，行是基因。行也可以是转录本，甚至是临床信息。

## Getting the input file

If your data has been organized into very_easy_input.csv format, you can skip this step and go directly to “Start drawing”.

Here, the samples are classified into two categories based on the immune cell matrix, and the classification information is added to the gene expression matrix. The sample names of the two files should be the same:

- ssGSEA_output.csv, immune cell matrix, columns are immune cells, rows are samples, generated by FigureYa71ssGSEA. The purpose is to categorize the samples, which can be replaced with other clinical information, mutation information, etc.
- easy_input_expr.csv, gene expression matrix, columns are samples, rows are genes. Rows can also be transcripts or even clinical information.

```{r}
source("install_dependencies.R")
# 免疫细胞的数据加载与预处理
# Loading and preprocessing of immune cell data

# 读取ssGSEA输出文件作为免疫细胞数据
# Read ssGSEA output file as immune cell data
tcga_gsva <- read.csv("ssGSEA_output.csv", row.names = 1)

# 将行名中的点号替换为连字符，符合样本ID格式
# Replace dots with hyphens in row names to match sample ID format
rownames(tcga_gsva) <- gsub("\\.", "-", rownames(tcga_gsva))

# 查看数据前几行几列，确认数据结构
# View first few rows and columns to confirm data structure
tcga_gsva[1:3, 1:3]

# 使用data.table包快速读取表达矩阵数据
# Quickly read expression matrix data using data.table package
tcga_expr <- data.table::fread("easy_input_expr.csv", data.table = F)

## 将第一列设置为行名（基因名）
## Set the first column as row names (gene names)
rownames(tcga_expr) <- tcga_expr[, 1]

## 移除第一列，只保留表达量数据
## Remove the first column, keeping only expression data
tcga_expr <- tcga_expr[, -1]

# 查看表达矩阵前几行几列，确认数据结构
# View first few rows and columns of expression matrix to confirm structure
head(tcga_expr)[, 1:4]
```

### 通过画热图聚类确定高、低免疫浸润的分组

### Subgroups of high and low immune infiltration were identified by drawing heat map clusters
