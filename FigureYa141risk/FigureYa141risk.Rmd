---
title: "FigureYa141risk"
author: "Ying Zhang"
reviewer: "Ying Ge, Junyi Shen"
date: "2025-5-20"
output: html_document
---

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 需求描述
## Requirement description

画风险因子关联图，中间用一条竖线把两组分开，signature的热图用两种颜色区分两组。
Draw a risk factor correlation graph, separate the two groups with a vertical line in the middle, and use two colors to distinguish the two groups in the signature heat map.

![](example1.png)

出自<https://febs.onlinelibrary.wiley.com/doi/full/10.1002/1878-0261.12315>
From <https://febs.onlinelibrary.wiley.com/doi/full/10.1002/1878-0261.12315>

![](example2.png)

出自<https://molecular-cancer.biomedcentral.com/articles/10.1186/s12943-016-0544-0>
From <https://molecular-cancer.biomedcentral.com/articles/10.1186/s12943-016-0544-0>

![](example3.png)

出自<https://translational-medicine.biomedcentral.com/articles/10.1186/s12967-019-2032-y>
From <https://translational-medicine.biomedcentral.com/articles/10.1186/s12967-019-2032-y>

## 应用场景
## Application scenario

同时展示risk score和表达量
Show risk score and expression at the same time

## 环境设置
## Environment settings


```{r}
source("install_dependencies.R")

```

加载包
Load package

```{r}
library(reshape2)
library(ggplot2)
library(scales)
library(cowplot)

Sys.setenv(LANGUAGE = "en") #显示英文报错信息 #Display English error message
options(stringsAsFactors = FALSE) #禁止chr转成factor #Disable chr to factor
```

## 输入文件
## Input file

easy_input_risk.csv，包含生存信息、表达量、risk score。其中risk score的获得，可以通过FigureYa31lasso计算并输出每个signature的系数coefficient，然后算出risk score，可参考这篇文章的第二步：<https://mp.weixin.qq.com/s/4s6X0dpvEqOh-KtxES3sTg>
easy_input_risk.csv, contains survival information, expression level, and risk score. The risk score can be obtained by calculating and outputting the coefficient of each signature through FigureYa31lasso, and then calculating the risk score. Please refer to the second step of this article: <https://mp.weixin.qq.com/s/4s6X0dpvEqOh-KtxES3sTg>

easy_input_sig.txt，signature。可以通过lasso、SVM等方法筛选获得，可参考FigureYa31lasso或FigureYa65SVM-RFE。
easy_input_sig.txt, signature. It can be obtained by screening through lasso, SVM and other methods, please refer to FigureYa31lasso or FigureYa65SVM-RFE.

```{r}
data <- read.csv("easy_input_risk.csv", row.names = 1)
data[1:2, 1:4]

bestvars <- read.table("easy_input_sig.txt")$V1
bestvars
```

## 按risk score分组
## Group by risk score

这里用中值做cutoff分组。还可以用X-tile找最佳分组cutoff；或用FigureYa4bestSeparation找到P value最小的分组；或用FigureYa35batch_bestSeparation，从一群基因中批量找最佳分组，并筛选出高低两组有显著差异的基因。可参考这篇的思路：<https://mp.weixin.qq.com/s/4s6X0dpvEqOh-KtxES3sTg>
Here, the median is used as the cutoff group. You can also use X-tile to find the best grouping cutoff; or use FigureYa4bestSeparation to find the group with the smallest P value; or use FigureYa35batch_bestSeparation to batch find the best grouping from a group of genes and filter out genes with significant differences between the high and low groups. You can refer to the idea of this article: <https://mp.weixin.qq.com/s/4s6X0dpvEqOh-KtxES3sTg>
