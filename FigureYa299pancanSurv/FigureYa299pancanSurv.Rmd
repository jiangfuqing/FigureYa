---
title: "FigureYa299pancanSurv"
params:
  author: "Xiaofan Lu; Yasi Zhang"
  reviewer: "Ying Ge"
  date: "2025-05-20"
output: html_document
---

**Author(s)**: `r params$author`
**Reviewer(s)**: `r params$reviewer`
**Date**: `r params$date`

# Academic Citation
If you use this code in your work or research, we kindly request that you cite our publication:

Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency. iMetaMed. https://doi.org/10.1002/imm3.70005


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 需求描述
# Demand description

想众筹下这张图，泛癌预后KM+Cox分析后，热图形式展示，最后再单独展示OS结果，内容看起来更立体丰富一点。

We want to crowdfund this figure - After pan-cancer prognostic KM + Cox analysis, display results in heatmap format, then separately showcase OS outcomes to make the content more three-dimensional and enriched.

![](example.png)

出自：<https://www.frontiersin.org/articles/10.3389/fonc.2021.665870/full>

图3 | (A) 基于单变量Cox回归和Kaplan-Meier模型，展示PDIA3表达与总生存期（OS）、疾病特异性生存期（DSS）、无病生存期（DFI）和无进展生存期（PFI）相关性的汇总结果。红色标注表示PDIA3是影响癌症患者预后的风险因素，绿色代表保护性因素。仅显示p值<0.05的显著性结果。
(B) 森林图通过单变量Cox回归方法展示PDIA3在各类癌症中的预后作用。红色标注的癌症类型表示PDIA3作为具有统计学意义的危险因素。

Source: <https://www.frontiersin.org/articles/10.3389/fonc.2021.665870/full>

FIGURE 3 | (A) Summary of the correlation between expression of PDIA3 with overall survival (OS), disease-specific survival (DSS), disease-free interval (DFI) and progression-free interval (PFI) based on the univariate Cox regression and Kaplan-Meier models. Red indicates that PDIA3 is a risk factor affecting the prognosis of cancer patients, and green represents a protective factor. Only p values < 0.05 are shown.
(B) The forest plot exhibited the prognostic role of PDIA3 in cancers by univariate Cox regression method. The cancer type in red represents the PDIA3 acts as a risky factor with statistical significance.

# 应用场景
# Application scenarios

在泛癌中根据某感兴趣基因的表达计算该表达与预后的相关性；绘制预后热图。

更多泛癌FigureYa看这里<https://k.youshop10.com/C8RkTgR3>

In pan-cancer analysis, calculate the correlation between the expression of a gene of interest and prognosis based on its expression; plot a prognostic heatmap.

For more pan-cancer FigureYa, check here<https://k.youshop10.com/C8RkTgR3>

# 环境设置
# Environment Setup


```{r}
source("install_dependencies.R")

```

# 加载包
# Loading packages

```{r}
library(ggplot2)
library(data.table)
library(survival)
library(ComplexHeatmap)
library(forestplot)
library(survminer)
library(circlize)

# 显示英文报错信息
# Show English error messages
Sys.setenv(LANGUAGE = "en")

# 禁止chr转成factor
# Prevent character-to-factor conversion
options(stringsAsFactors = FALSE)
```

# 输入文件
# Input Files

跟FigureYa291PancanProgSigature<https://k.youshop10.com/OH-gnWgI>的输入文件相同，不用重复下载。

merged_sample_quality_annotations.tsv，肿瘤注释文件。下载自<https://gdc.cancer.gov/about-data/publications/pancanatlas>，下载地址<http://api.gdc.cancer.gov/data/1a7d7be8-675d-4e60-a105-19d4121bdebf>。

EBPlusPlusAdjustPANCAN_IlluminaHiSeq_RNASeqV2.geneExp.tsv，表达矩阵，第一列是基因，之后是其在每个样本中的表达量。下载自<http://api.gdc.cancer.gov/data/3586c0da-64d0-4b74-a449-5ff4d9136611>。

Survival_SupplementalTable_S1_20171025_xena_sp，生存数据。来自<https://xenabrowser.net/datapages/?dataset=Survival_SupplementalTable_S1_20171025_xena_sp&host=https%3A%2F%2Fpancanatlas.xenahubs.net&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443>。

The input files are the same as those for FigureYa291PancanProgSignature <https://k.youshop10.com/OH-gnWgI>, so there is no need to download them again.

merged_sample_quality_annotations.tsv: Tumor annotation file. Downloaded from <https://gdc.cancer.gov/about-data/publications/pancanatlas>, direct download link: <http://api.gdc.cancer.gov/data/1a7d7be8-675d-4e60-a105-19d4121bdebf>.

EBPlusPlusAdjustPANCAN_IlluminaHiSeq_RNASeqV2.geneExp.tsv: Expression matrix, where the first column contains gene names and subsequent columns show expression levels in each sample. Downloaded from<http://api.gdc.cancer.gov/data/3586c0da-64d0-4b74-a449-5ff4d9136611>.

Survival_SupplementalTable_S1_20171025_xena_sp: Survival data. Source: <https://xenabrowser.net/datapages/?dataset=Survival_SupplementalTable_S1_20171025_xena_sp&host=https%3A%2F%2Fpancanatlas.xenahubs.net&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443>.
